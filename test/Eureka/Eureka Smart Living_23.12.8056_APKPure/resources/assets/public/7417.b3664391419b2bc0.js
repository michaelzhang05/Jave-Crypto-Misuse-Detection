"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7417,9764],{7417:(w,B,r)=>{r.r(B),r.d(B,{ArmSettingsPageModule:()=>J});var _=r(96814),h=r(56223),c=r(73582),S=r(70160),b=r(15861),u=r(8873);class T{constructor(){this.isArmed=!1,this.indent="",this.children=[],this.isDisabled=!1,this.devicesCount=0}}var f=r(1901),l=r(46729),d=r(77144),A=r(43826),p=r(51141),t=r(65879),I=r(34414),x=r(59764),y=r(63999);function O(a,v){if(1&a&&(t.TgZ(0,"span",14),t._uU(1),t.qZA()),2&a){const o=t.oxw().$implicit;t.xp6(1),t.Oqu(o.lastBreachedDisplayString)}}function k(a,v){if(1&a){const o=t.EpF();t.TgZ(0,"ion-card",8)(1,"ion-item",9)(2,"ion-avatar",10),t._UZ(3,"img",11),t.qZA(),t.TgZ(4,"ion-label"),t._uU(5),t._UZ(6,"br"),t.YNc(7,O,2,1,"span",12),t.qZA(),t.TgZ(8,"ion-toggle",13),t.NdJ("ngModelChange",function(n){const i=t.CHM(o).$implicit;return t.KtG(i.isArmed=n)})("ngModelChange",function(){const s=t.CHM(o).$implicit,i=t.oxw();return t.KtG(i.updateItemArmStatus(s))}),t.qZA()()()}if(2&a){const o=v.$implicit;t.Udp("margin-left",20*o.level+"px")("border",o.isBreached?"2px solid red":""),t.Q6J("id","DEVICE_"+o.thingId),t.xp6(3),t.Q6J("src",o.image,t.LSH),t.xp6(2),t.hij(" ",o.name,""),t.xp6(2),t.Q6J("ngIf",o.isBreached),t.xp6(1),t.Tol(o.isArmed?"toggle-on":"toggle-off"),t.Q6J("disabled",o.isDisabled)("ngModel",o.isArmed)}}const Z=[{path:"",component:(()=>{var a;class v{ngOnInit(){console.log("Arm Setting did load"),this.InitializePage()}constructor(e,n,s,i){this.navCtrl=e,this.platform=n,this.popoverCtrl=s,this.navParams=i,this.items=[],this.breachedIds=[],this.initializeDelay=-1,this.theAppState=u.a,this.lastUpdateTimer=-1,u.a.DefaultController||e.navigateRoot(p.g6)}ionViewWillLoad(){this.bindedReinit=()=>{clearTimeout(this.initializeDelay),this.initializeDelay=window.setTimeout(()=>{console.warn("Breached Alert"),this.InitializePage()},2e3)},l.V0.events.subscribe(A.n.BREACH_ALERT,this.bindedReinit)}ionViewWillLeave(){console.log("ionic will leave arm settings"),l.V0.events.unsubscribe(A.n.BREACH_ALERT,this.bindedReinit),this.bindedReinit=void 0}updateAllRelativeItems(e){var n=this;return(0,b.Z)(function*(){if(e.type==f.a.Room)for(let s=0;s<e.children.length;s++){let i=e.children[s];i.type==f.a.Room?(i.isArmed=e.isArmed,yield n.updateAllRelativeItems(i)):i.isDisabled||(i.isArmed=e.isArmed,i.type==f.a.Device&&n.setArmSettings(u.a.DefaultController.devices.find(m=>m.id==i.thingId),i.isArmed),e.isBreached||n.removehighlight("DEVICE_"+i.thingId))}})()}updateItemArmStatus(e){var n=this;return(0,b.Z)(function*(){for(let i=0;i<e.children.length;i++){let m=e.children[i];m.isDisabled||(m.isArmed=e.isArmed,m.type==f.a.Device&&(yield n.setArmSettings(u.a.DefaultController.devices.find(D=>D.id==m.thingId),m.isArmed))),yield n.updateAllRelativeItems(m)}let s=!0;for(let i=0;i<n.items.length;i++)s=n.items[i].isArmed&&s;if(n.allArmStatus=s,e.parent&&(e.type==f.a.Device||e.type==f.a.Room)){let m=e.parent;for(;null!=m;){let D=!1;m.children.forEach(P=>{D=D||P.isArmed||e.isArmed}),m.isArmed=D,m=m.parent}}e.type==f.a.Device&&(yield n.setArmSettings(u.a.DefaultController.devices.find(i=>i.id==e.thingId),e.isArmed)),e.isBreached||n.removehighlight("DEVICE_"+e.thingId)})()}InitializePage(){this.items=[],this.allArmStatus=!1,this.breachedIds=[],this.breachedIds=u.a.getBreachDeviceIds;let e=u.a.DefaultController.rooms.filter(n=>null==n.parent_id);for(let n=0;n<e.length;n++)this.createRoomsTree(e[n]);this.items.reverse(),this.updateTimer()}createRoomsTree(e,n=0){let s=!1,i=[],m=!1;for(let g=0;g<e.children_rooms.length;g++){let E=this.createRoomsTree(e.children_rooms[g],n+1);E&&(m=m||E.isArmed),s=s||null!=E,E&&i.push(E)}let D=[],P=!1,R=!1;for(let g=0;g<e.devices.length;g++){let C=e.devices[g];if(C.visible&&(C.type==d.Y.DoorSensor||C.type==d.Y.MotionSensor)){s=!0,P=!0;let E=this.getDeviceArmItem(C,n+1);R=R||E.isArmed,this.items.push(E),D.push(E)}}if(s){let g=this.getRoomArmItem(e);if(g.level=n,g.isArmed=R,P&&(g.children=D,D.forEach(C=>{C.parent=g})),i.length>0)for(var M=0;M<i.length;M++)i[M].parent=g,g.children.push(i[M]);return s=!0,m&&(g.isArmed=!0),this.items.push(g),g}}getDeviceArmItem(e,n=0,s=void 0){let i=new T;return i.name=e.getTranslatedName(),i.image=e.image_id.main_url,i.level=n,i.isArmed=e.Armed,i.isDisabled=!e.online||e.permission_readonly||!e.enabled,i.parent=s,s&&(s.children.push(i),s.devicesCount++),i.thingId=e.id,this.breachedIds.indexOf(e.id)>-1&&(i.isBreached=!0),i.type=f.a.Device,e.ArmingLastBreached&&e.isBreached&&(i.lastBreachedDateTime=e.ArmingLastBreached,i.lastBreachedDisplayString=l.V0.getElapsedDateTime(e.ArmingLastBreached)),i}getRoomArmItem(e,n=0,s=void 0){let i=new T;return i.image=e.image_url,i.thingId=e.id,i.parent=s,s&&(s.children.push(i),s.devicesCount=i.devicesCount),i.type=f.a.Room,i.name=e.getTranslatedName(),i}highlightBreached(e){let n=document.getElementById(e);n&&n.classList.add("expose")}removehighlight(e){let n=document.getElementById(e);n&&n.classList.remove("expose")}scrollTo(e){let n=document.getElementById(e);n&&this.content.scrollToPoint(0,n.offsetTop,700)}updateTimer(){clearInterval(this.lastUpdateTimer),this.lastUpdateTimer=window.setInterval(()=>{for(let e=0;e<this.items.length;e++){let n=this.items[e];n.type==f.a.Device&&n.lastBreachedDateTime&&(n.lastBreachedDisplayString=l.V0.getElapsedDateTime(n.lastBreachedDateTime))}},1e3)}ionViewDidEnter(){if(this.breachedIds.sort(),this.breachedIds.length>0){this.scrollTo("DEVICE_"+this.breachedIds[0]);for(let e=0;e<this.breachedIds.length;e++)this.highlightBreached("DEVICE_"+this.breachedIds[e])}}setArmSettings(e,n){return e.setArmed(n)}goBack(e=!1){e?this.navCtrl.navigateBack(p.g6):this.navCtrl.pop()}}return(a=v).\u0275fac=function(e){return new(e||a)(t.Y36(I.SH),t.Y36(I.t4),t.Y36(I.Dh),t.Y36(I.X1))},a.\u0275cmp=t.Xpm({type:a,selectors:[["arm-settings"]],viewQuery:function(e,n){if(1&e&&t.Gf(c.W2,5),2&e){let s;t.iGM(s=t.CRH())&&(n.content=s.first)}},decls:12,vars:6,consts:[[3,"translucent"],[2,"padding","5px"],[2,"float","left","display","block","margin-top","16px"],["tappable","","component-click","","tabindex","0",1,"top-mic-button",2,"font-size","30px","color","white","text-align","center","vertical-align","middle",3,"click"],["name","chevron-back"],[2,"margin-top","15px","text-align","center"],[3,"fullscreen"],["ngFor","",3,"ngForOf"],[1,"arm-card",2,"padding","0px","margin","1px",3,"id"],[1,"arm-card"],["slot","start"],[1,"arm-img",3,"src"],["style","font-size:small;",4,"ngIf"],["checked","false","slot","end",1,"default-toggle",2,"margin","5px",3,"disabled","ngModel","ngModelChange"],[2,"font-size","small"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"div",1)(3,"div",2)(4,"a",3),t.NdJ("click",function(){return n.goBack()}),t._UZ(5,"ion-icon",4),t.qZA()()(),t.TgZ(6,"ion-title",5),t._uU(7),t.ALo(8,"translate"),t.qZA()()(),t.TgZ(9,"ion-content",6)(10,"ion-list"),t.YNc(11,k,9,12,"ng-template",7),t.qZA()()),2&e&&(t.Q6J("translucent",!0),t.xp6(7),t.hij(" ",t.lcZ(8,4,"arming")," "),t.xp6(2),t.Q6J("fullscreen",!0),t.xp6(2),t.Q6J("ngForOf",n.items))},dependencies:[_.sg,_.O5,h.JJ,h.On,c.BJ,c.PM,c.W2,c.Gu,c.gu,c.Ie,c.Q$,c.q_,c.wd,c.ho,c.sr,c.w,x.T,y.X$],styles:["ion-item.arm-card[_ngcontent-%COMP%]{margin-bottom:10px;box-shadow:.2vw .2vw 1vw #000000ba;background-color:#0003;border-radius:3vw}"]}),v})()}];let L=(()=>{var a;class v{}return(a=v).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[S.Bz.forChild(Z),S.Bz]}),v})();var H=r(23934);let J=(()=>{var a;class v{}return(a=v).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[_.ez,h.u5,c.Pc,L,H.o,y.aw]}),v})()},59764:(w,B,r)=>{r.d(B,{T:()=>b});var _=r(15861),h=r(65879),c=r(56223),S=r(28662);let b=(()=>{var u;class T{mouseDownEventHandler(l){l.stopImmediatePropagation(),l.preventDefault()}keyEventHandler(l){var d=this;return(0,_.Z)(function*(){if(l.stopImmediatePropagation(),l.preventDefault(),"Enter"==l.key||" "==l.key){var A;let p=null===(A=document.activeElement)||void 0===A?void 0:A.className.toLowerCase();if(p&&(p.indexOf("range-knob-handle")>-1||p.indexOf("range-md")>-1)&&p.indexOf("range-knob-handle")>-1&&(console.log("range-knob-handle"),document.activeElement&&document.activeElement.getAttribute("aria-valuenow"))){let x=document.activeElement.getAttribute("aria-valuenow");if(x){let y=Number.parseFloat(x);if(y||0===y)return console.log("range-knob-handle value change to "+y),void d.model.update.emit(y)}}let t=d.el.nativeElement.nodeName.toLowerCase();const I=yield S.A.getInfo();["button","ion-checkbox","a"].indexOf(t)>-1?"android"!==I.operatingSystem.toLowerCase()&&d.el.nativeElement.click():"!android"!==I.operatingSystem.toLowerCase()&&d.clickOnElement(d.el)}})()}clickOnElement(l){if(document.createEvent){let d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),l.nativeElement.dispatchEvent(d)}}mouseDownOnElement(l){let d=new MouseEvent("mousedown",{bubbles:!0,cancelable:!1});l.nativeElement.dispatchEvent(d)}constructor(l,d,A){this.el=l,this.renderer=d,this.model=A,this.eventEmitter=new h.vpe}ngOnInit(){}}return(u=T).\u0275fac=function(l){return new(l||u)(h.Y36(h.SBq),h.Y36(h.Qsj),h.Y36(c.On))},u.\u0275dir=h.lG2({type:u,selectors:[["","component-click",""]],hostBindings:function(l,d){1&l&&h.NdJ("mousedown",function(p){return d.mouseDownEventHandler(p)})("keypress",function(p){return d.keyEventHandler(p)})},outputs:{eventEmitter:"eventEmitter"},features:[h._Bn([c.On])]}),T})()}}]);