"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1392],{61392:(pe,J,u)=>{u.r(J),u.d(J,{Rooms2PageModule:()=>ue});var A=u(96814),S=u(56223),p=u(73582),D=u(70160),x=u(15861),b=u(46729),P=u(51141),R=u(77144),I=u(9952),L=u(37092),Y=u(56544),h=u(8873),N=u(15231),F=u(19462),G=u(7110),e=u(65879),y=u(34414),E=u(63999),z=u(77935),U=u(69705);function Q(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-col",6)(1,"ion-searchbar",7),e.NdJ("ionInput",function(o){e.CHM(i);const n=e.oxw();return e.KtG(n.getItems(o))}),e.ALo(2,"translate"),e.qZA()()}2&r&&(e.xp6(1),e.s9C("placeholder",e.lcZ(2,1,"search")))}function H(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.toggle_editmode())}),e._UZ(1,"ion-icon",11),e.qZA()}}function V(r,_){if(1&r&&(e.TgZ(0,"ion-col",8),e.YNc(1,H,2,0,"button",9),e.qZA()),2&r){const i=e.oxw();e.xp6(1),e.Q6J("ngIf",!i.reorderSaveState)}}function $(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.add_room())}),e._UZ(1,"ion-icon",15),e.qZA()}}function K(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.toggle_reorder())}),e._UZ(1,"ion-icon",16),e.qZA()}}function q(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.get_default_order())}),e._UZ(1,"ion-icon",17),e.qZA()}}function B(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.save_reorder())}),e._UZ(1,"ion-icon",18),e.qZA()}}function j(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2);return e.KtG(o.cancel_reorder())}),e._UZ(1,"ion-icon",19),e.qZA()}}function W(r,_){if(1&r&&(e.TgZ(0,"ion-col",12)(1,"div",13)(2,"ion-buttons",14),e.YNc(3,$,2,0,"button",9),e.YNc(4,K,2,0,"button",9),e.YNc(5,q,2,0,"button",9),e.YNc(6,B,2,0,"button",9),e.YNc(7,j,2,0,"button",9),e.qZA()()()),2&r){const i=e.oxw();e.xp6(3),e.Q6J("ngIf",i.editmode),e.xp6(1),e.Q6J("ngIf",!i.reorderSaveState),e.xp6(1),e.Q6J("ngIf",i.reorderSaveState),e.xp6(1),e.Q6J("ngIf",i.reorderSaveState),e.xp6(1),e.Q6J("ngIf",i.editmode)}}function X(r,_){if(1&r&&(e.TgZ(0,"div",37),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const i=e.oxw(3).$implicit;e.xp6(1),e.AsE("",e.lcZ(2,2,"temperature"),": ",i.temp,"")}}function ee(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-row",31),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.openRoom(o))}),e.TgZ(1,"ion-col",32)(2,"div",33)(3,"div",34)(4,"div",35),e._uU(5),e.qZA(),e._UZ(6,"div")(7,"div"),e.YNc(8,X,3,4,"div",36),e.qZA()()()()}if(2&r){const i=e.oxw(2).$implicit;e.xp6(5),e.Oqu(i.translated_name),e.xp6(3),e.Q6J("ngIf",i.have_temp)}}function te(r,_){if(1&r&&(e.TgZ(0,"ion-select-option",42),e._uU(1),e.qZA()),2&r){const i=_.$implicit;e.Q6J("value",i.id),e.xp6(1),e.Oqu(i.name)}}function oe(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-row",33)(1,"ion-col",32)(2,"div",33)(3,"div",34)(4,"div",38)(5,"ion-input",39),e.NdJ("ngModelChange",function(o){e.CHM(i);const n=e.oxw(2).$implicit;return e.KtG(n.name=o)})("ionBlur",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.SaveRoomInformation(o))}),e.qZA()(),e.TgZ(6,"div",40)(7,"ion-select",41),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(3);return e.KtG(o.scrollToSelected())})("ngModelChange",function(o){e.CHM(i);const n=e.oxw(2).$implicit;return e.KtG(n.parent_id=o)})("ionChange",function(o){e.CHM(i);const n=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.onSelectChange(o,n))}),e.ALo(8,"translate"),e.TgZ(9,"ion-select-option",42),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.YNc(12,te,2,2,"ion-select-option",43),e.qZA()(),e.TgZ(13,"div",44)(14,"ion-button",45),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.selectImage(o))}),e._uU(15),e.ALo(16,"translate"),e._UZ(17,"ion-icon",46),e.qZA()()()()()()}if(2&r){const i=e.oxw(2).$implicit,t=e.oxw();e.xp6(5),e.Q6J("ngModel",i.name),e.xp6(2),e.Q6J("label",e.lcZ(8,7,"Room is Child of "))("ngModel",i.parent_id),e.xp6(2),e.Q6J("value",-1),e.xp6(1),e.Oqu(e.lcZ(11,9,"None")),e.xp6(2),e.Q6J("ngForOf",t.list_of_rooms),e.xp6(3),e.hij(" ",e.lcZ(16,11,"Background ")," ")}}function ne(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"div",47)(1,"div",48),e._UZ(2,"img",49),e.TgZ(3,"span",50),e._uU(4),e.qZA()(),e.TgZ(5,"div",48),e._UZ(6,"img",49),e.TgZ(7,"span",51),e._uU(8),e.qZA()(),e.TgZ(9,"div",52),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.showOccupancyDialog(o))}),e._UZ(10,"img",53),e.TgZ(11,"span",54),e._uU(12),e.qZA()(),e.TgZ(13,"div",48),e._UZ(14,"img",53),e.TgZ(15,"span",55),e._uU(16),e.qZA()()()}if(2&r){const i=e.oxw(2).$implicit,t=e.oxw();e.xp6(1),e.Tol(i.have_msensor?"":"inactive"),e.xp6(1),e.Q6J("src",i.is_msensor_active?t.IMAGES.motion.active:t.IMAGES.motion.idle,e.LSH),e.xp6(2),e.Oqu(i.sensor_breached_time_string),e.xp6(1),e.Tol(i.have_door?"":"inactive"),e.xp6(1),e.Q6J("src",i.is_door_open?t.IMAGES.door_open_icon:t.IMAGES.door_close_icon,e.LSH),e.xp6(2),e.Oqu(i.door_breached_time_string),e.xp6(1),e.Tol(null!=i.OccupancyState?"":"inactive"),e.xp6(1),e.Udp("background-image",i.ForceOccupancyState?"url("+t.IMAGES.forced_occupancy+")":i.ManualOccupancyState?"url("+t.IMAGES.manual_occupancy+")":""),e.Q6J("src",i.OccupancyState?t.IMAGES.occupied:t.IMAGES.unoccupied,e.LSH),e.xp6(2),e.Oqu(i.OccupancyDT),e.xp6(1),e.Tol(i.have_temp?"":"inactive"),e.xp6(1),e.Q6J("src",t.IMAGES.thermometer_icon,e.LSH),e.xp6(2),e.Oqu(i.temp)}}function ie(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-button",56),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.toggleLights(o))}),e._UZ(1,"img",57),e.qZA()}if(2&r){const i=e.oxw(2).$implicit,t=e.oxw();e.Tol(i.have_lights?"":" inactive"),e.ekj("active",i.is_lights_on),e.xp6(1),e.Q6J("src",i.is_lights_on?t.IMAGES.light._100:t.IMAGES.light._10,e.LSH)}}function re(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-button",56),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.toggleAC(o))}),e._UZ(1,"img",57),e.qZA()}if(2&r){const i=e.oxw(2).$implicit,t=e.oxw();e.Tol(i.have_ac?"":" inactive"),e.ekj("active",i.is_ac_on),e.xp6(1),e.Q6J("src",i.is_ac_on?t.IMAGES.thermostat_state.on:t.IMAGES.thermostat_state.off,e.LSH)}}function ae(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-button",56),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.toggleCurtains(o))}),e._UZ(1,"img",57),e.qZA()}if(2&r){const i=e.oxw(2).$implicit,t=e.oxw();e.Tol(i.have_curtain?"":" inactive"),e.ekj("active",i.is_curtains_open),e.xp6(1),e.Q6J("src",i.is_curtains_open?t.IMAGES.shutter._100:t.IMAGES.shutter._0,e.LSH)}}function se(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"ion-button",56),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.toggleFans(o))}),e._UZ(1,"img",57),e.qZA()}if(2&r){const i=e.oxw(2).$implicit,t=e.oxw();e.Tol(i.have_fan?"":" inactive"),e.ekj("active",i.is_fan_on),e.xp6(1),e.Q6J("src",i.is_fan_on?t.IMAGES.fan_on_icon:t.IMAGES.fan_off_icon,e.LSH)}}function le(r,_){if(1&r){const i=e.EpF();e.TgZ(0,"div",58)(1,"button",59),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.moveItemUp(o))}),e._UZ(2,"ion-icon",60),e.qZA(),e.TgZ(3,"button",61),e.NdJ("click",function(){e.CHM(i);const o=e.oxw(2).$implicit,n=e.oxw();return e.KtG(n.moveItemDown(o))}),e._UZ(4,"ion-icon",62),e.qZA()()}}function ce(r,_){if(1&r&&(e.TgZ(0,"ion-card",22)(1,"ion-grid",23),e.YNc(2,ee,9,2,"ion-row",24),e.YNc(3,oe,18,13,"ion-row",25),e.YNc(4,ne,17,18,"div",26),e.qZA(),e.TgZ(5,"ion-footer")(6,"ion-toolbar",27)(7,"ion-buttons",28),e.YNc(8,ie,2,5,"ion-button",29),e.YNc(9,re,2,5,"ion-button",29),e.YNc(10,ae,2,5,"ion-button",29),e.YNc(11,se,2,5,"ion-button",29),e.qZA()()(),e.YNc(12,le,5,0,"div",30),e.qZA()),2&r){const i=e.oxw().$implicit,t=e.oxw();e.Akn("margin:15px 10px 15px 10px;"+t.getRoomStyle(i)),e.xp6(2),e.Q6J("ngIf",!t.editmode),e.xp6(1),e.Q6J("ngIf",t.editmode),e.xp6(1),e.Q6J("ngIf",!t.editmode),e.xp6(4),e.Q6J("ngIf",!t.editmode&&i.have_lights),e.xp6(1),e.Q6J("ngIf",!t.editmode&&i.have_ac),e.xp6(1),e.Q6J("ngIf",!t.editmode&&i.have_curtain),e.xp6(1),e.Q6J("ngIf",!t.editmode&&i.have_fan),e.xp6(1),e.Q6J("ngIf",t.reorderSaveState&&t.editmode)}}function de(r,_){if(1&r&&(e.TgZ(0,"ion-reorder",20),e.YNc(1,ce,13,10,"ion-card",21),e.qZA()),2&r){const i=_.$implicit;e.Q6J("key",i.id),e.xp6(1),e.Q6J("ngIf",i)}}const _e=[{path:"",component:(()=>{var r;class _ extends Y.n{getRoomStyle(t){let o="",n="";return n="filter:grayscale(0);",o=t.image_id<72?"background:url('"+t.image_url+"') no-repeat center center;background-size: contain;":"background:url('"+t.image_url+"') no-repeat center center;background-size: cover;",o+="filter:grayscale(0);",o}saveData(){this.editmode=!1,this.enable_reorder=!1}selectImage(t){var o=this;return(0,x.Z)(function*(){const n=yield o.modalCtrl.create({component:G.R,componentProps:{index:t.image_id,filter:"user"},backdropDismiss:!1});yield n.present();const{data:a}=yield n.onDidDismiss();a&&a.id&&(t.image_id=a.id,t.image_url=a.url,yield o.SaveRoomInformation(t))})()}SaveRoomInformation(t){var o=this;return(0,x.Z)(function*(){let n=h.a.DefaultController.rooms.find(s=>s.id===t.id);n.image_id=t.image_id,n.name=t.name,n.parent_id=t.parent_id;let a=o.addedRooms.find(s=>s.id===t.id);a.name!=t.name&&(a.name=t.name),yield h.a.DefaultController.ConnectionChanged(),yield h.a.DefaultController.LoadAllRoomEntityDTO(t.id).then(s=>{let c=s;c.roomEntity.name=t.name,c.roomEntity.parentId=t.parent_id,c.roomEntity.imageId=t.image_id,h.a.DefaultController.SaveRoomEntity("update",c,t.id).then(C=>{o.showToast("Room Information Saved")}).catch(C=>{console.error("Unable to Save",C)})}).catch(s=>{console.error("Unable to LoadAllRoomEntityDTO",s)})})()}changeEdit(){}updatestatetest2(t){this.updateRoomsLink()}updateRoomsLink(){var t=this;return(0,x.Z)(function*(){for(let o=0;o<t.listOfRooms.length;o++){let n=h.a.DefaultController.rooms.find(a=>a.id===t.listOfRooms[o].id);t.listOfRooms[o]=n}})()}updatestatetest(t){this.updateRoomInfo(t)}openMoreMenu(){throw new Error("Method not implemented.")}openHistoryPage(){throw new Error("Method not implemented.")}openSchedulePage(){throw new Error("Method not implemented.")}openRoomsPage(){throw new Error("Method not implemented.")}toggleDoors(t){throw new Error("Method not implemented.")}constructor(t,o,n,a,s,c,v,C,k,M,w,O,Z,T){if(super(o,s,n,a,t,c,!1,O),this.navCtrl=t,this.platform=s,this.popoverCtrl=v,this.loadingCtrl=M,this.navParams=w,this.router=O,this.changeDetector=Z,this.modalCtrl=T,this.imageDescription="",this.editmode=!1,this.IMAGES=F.s.Images,this.next_type="device",this.filter="",this._temp_update_timer2=-1,this.delay_update=!1,this.delay_update_timeout=-1,this.enable_reorder=!1,this.theAppState=h.a,this.toggleLightsForRoom=(m,f)=>{for(let g=0;g<m.children_rooms.length;g++)this.toggleLightsForRoom(m.children_rooms[g],f);console.log("toggle lights for room",m.name),this.delay_update=!0;let d=f;for(let g=0;g<m.devices.length;g++){let l=m.devices[g];l.permission_readonly||l.ExcludeFromRoomControl||l.category==I.I.Lighting&&(l.type==R.Y.Switch||l.type==R.Y.Dimmer||l.type==R.Y.RGB)&&l.turnState(d)}},this.toggleCurtainsForRoom=(m,f)=>{for(let g=0;g<m.children_rooms.length;g++)this.toggleCurtainsForRoom(m.children_rooms[g],f);this.delay_update=!0;let d=f;for(let g=0;g<m.devices.length;g++){let l=m.devices[g];l.permission_readonly||l.category==I.I.Curtains&&l.type==R.Y.Shutter&&(d?l.turnOn():l.turnOff())}},this.toggleFansForRoom=(m,f)=>{for(let g=0;g<m.children_rooms.length;g++)this.toggleFansForRoom(m.children_rooms[g],f);console.log("toggle fans for room",m.name),this.delay_update=!0;let d=f;for(let g=0;g<m.devices.length;g++){let l=m.devices[g];l.permission_readonly||l.ExcludeFromRoomControl||l.category==I.I.Fan&&(l.type==R.Y.Switch||l.type==R.Y.Dimmer)&&l.turnState(d)}},this.toggleACForRoom=(m,f)=>{console.log("Toggle AC for room",m.name);for(let g=0;g<m.children_rooms.length;g++)this.toggleACForRoom(m.children_rooms[g],f);this.delay_update=!0;let d=f;for(let g=0;g<m.devices.length;g++){let l=m.devices[g];l.permission_readonly||l.category==I.I.HVAC&&l.type==R.Y.Thermostat&&(1==d?l.turnOn():0==d&&l.turnOff())}},this.longPressCounter=0,this.longPressDetected=!1,this.yScrollDt=0,this.reorderRoomsIds=[],this.reorderSaveState=!1,this.disable_hand=!0,this.list_of_rooms=[],this._screen=screen,O.getCurrentNavigation().extras.state){const m=this.router.getCurrentNavigation().extras.state;if(console.log(m," params"),null!=m.data){let f=this.navParams.get("filter");null==f||null==f||(this.filter=f)}}this.InitializeAllRooms()}_delay4sUpdate(){this.refreshAllRooms()}InitializeAllRooms(){var t=this;return(0,x.Z)(function*(){if(console.time("initializeAllRooms"),t.addedRooms=[],null!=h.a.DefaultController&&null!=h.a.DefaultController.rooms){if(t.rootaddedRooms=h.a.DefaultController.rooms.filter(o=>o.visible&&!o.parent_room).sort((o,n)=>{let a=t.compare(o.sort_order,n.sort_order);return 0==a&&(a=t.compare(o.translated_name,n.translated_name)),a}),t.rootaddedRooms&&t.rootaddedRooms.length)for(let o=0;o<t.rootaddedRooms.length;o++)if(t.addedRooms.push(t.rootaddedRooms[o]),t.childrenRooms=t.rootaddedRooms[o].children_rooms.filter(n=>n.visible).sort((n,a)=>{let s=t.compare(n.sort_order,a.sort_order);return 0==s&&(s=t.compare(n.translated_name,a.translated_name)),s}),t.childrenRooms&&t.childrenRooms.length)for(let n=0;n<t.childrenRooms.length;n++)t.addedRooms.push(t.childrenRooms[n]);if(t.addedRooms&&t.addedRooms.length)for(let o=0;o<t.addedRooms.length;o++)t.addedRooms[o].updateTranslatedName();t.listOfRooms=t.addedRooms}else t.navCtrl.navigateRoot(P.g6,{animationDirection:"forward"});console.timeEnd("initializeAllRooms")})()}get AppIcon(){return L.Y.getAppLogo}ionViewDidLeave(){this._delay4sUpdate&&(b.V0.events.unsubscribe(N.B.DeviceUpdate,this._delay4sUpdate),this._delay4sUpdate=void 0),clearInterval(this._temp_update_timer2),clearTimeout(this.delay_update_timeout)}updateTimer(){for(let t=0;t<this.addedRooms.length;t++){let o=this.addedRooms[t];o.have_door&&(o.door_breached_time_string=b.V0.getElapsedDateTime(new Date(o.door_breached_time),this.translate.currentLang,!1)),o.have_msensor&&(o.sensor_breached_time_string=b.V0.getElapsedDateTime(new Date(o.sensor_breached_time),this.translate.currentLang,!1));let n=1==o.OccupancyState?o.OccupiedSince:o.UnoccupiedSince;n&&(o.OccupancyDT=b.V0.getElapsedDateTime(new Date(n),this.translate.currentLang,!1))}}updateRoomInfo(t){var o=this;return(0,x.Z)(function*(){yield o._updateRoomInfo(t)})()}_updateRoomInfo(t){t.is_ac_locked=!1,t.have_temp=!1,t.have_door=!1,t.is_door_open=!1,t.have_msensor=!1,t.have_humidity=!1,t.is_lights_locked=!1,t.is_curtains_locked=!1,t.is_msensor_active=!1,t.lights_value=0,t.curtains_value=0,t.door_breached_time=0,t.sensor_breached_time=0,t.temp=" ",t.humidity=" ",t.door_breached_time_string="",t.sensor_breached_time_string="";let o=1==t.OccupancyState?t.OccupiedSince:t.UnoccupiedSince;o&&(t.OccupancyDT=b.V0.getElapsedDateTime(new Date(o),this.translate.currentLang,!1));let n=0,a=0,s=!1,c=new Date(1971,1,1).valueOf(),v=!1,C=new Date(1971,1,1).valueOf(),k=this.getRoomAllDevices(t);for(let M=0;M<k.length;M++){let w=k[M];if(w.online&&w.visible&&w.enabled)switch(w.type){case R.Y.DoorSensor:let O=w;t.have_door=!0;let Z=w;if(s=s||O.IsOn,s){let d=Date.parse(Z.LastBreached.toString());c<d&&(c=d,t.door_breached_time=d)}else{let d=Date.parse(Z.LastClosed.toString());c<d&&(c=d,t.door_breached_time=d)}break;case R.Y.MotionSensor:t.have_msensor=!0,v=v||w.IsOn;let T=w;if(v&&T.LastBreached){let d=T.LastBreached.valueOf();C<d&&(t.sensor_breached_time=d,C=d)}else if(T.LastInactive){let d=T.LastInactive.valueOf();C<d&&(t.sensor_breached_time=d,C=d)}break;case R.Y.HumiditySensor:t.have_humidity=!0,t.humidity=w.value+"%";break;case R.Y.TemperatureSensor:if(w.visible&&w.enabled&&w.online){let d=this.convertTempToC(w.properties.Value,w.properties.unit);null!=d&&!Number.isNaN(d)&&0!=d&&(n+=d,a+=1),t.have_temp=!0}break;case R.Y.Thermostat:if(w.visible&&w.enabled&&w.online){let d=this.convertTempToC(w.RoomTemperature,w.room_temperature_unit);null!=d&&0!=d&&(n+=d,a+=1),t.have_temp=!0}}}return t.is_msensor_active=v,t.have_msensor&&(t.sensor_breached_time=C,t.sensor_breached_time_string=b.V0.getElapsedDateTime(new Date(t.sensor_breached_time),this.translate.currentLang,!1)),t.is_door_open=s,t.door_breached_time_string=b.V0.getElapsedDateTime(t.door_breached_time,this.translate.currentLang,!1),t.is_lights_locked=t.is_lights_locked&&t.have_lights,t.is_ac_locked=t.is_ac_locked&&t.have_ac,t.is_curtains_locked=t.is_curtains_locked&&t.have_curtain,a>0&&(t.temp=0!=n?(n/a).toFixed(0)+"\xb0C":"---\xb0C"),t}convertTempToC(t,o="C"){if(o=o.toLowerCase(),t=Number(t),!Number.isNaN(t))return"k"==o?t-273.15:"f"==o?.5555*(t-32):t}findExisitingRoom(t,o){let n=!1;for(let a=0;a<t.length;a++)if(t[a]===o){n=!0;break}return n}toggle(t,o,n,a,s,c,v=!0){var C=this;return(0,x.Z)(function*(){v&&t.children_rooms.length>0?(yield C.alertCtrl.create({header:o,message:n,cssClass:"network-alert",buttons:[{text:C.translate.instant(a),handler:()=>{c(t,s)}},{text:C.translate.instant("cancel"),role:"cancel",handler:()=>{}}]})).present():c(t,s)})()}toggleLights(t,o=!0){var n=this;return(0,x.Z)(function*(){if(n.editmode)return;let a=n.translate.instant(t.is_lights_on?"turn-off-all-light":"turn-on-all-light"),s=n.translate.instant(t.is_lights_on?"TurnOff":"TurnOn");n.toggle(t,t.name,a,s,!t.is_lights_on,n.toggleLightsForRoom,o),window.setTimeout(()=>{n.refreshAllRooms()},2e3)})()}toggleAC(t,o=!0){if(this.editmode)return;let n=this.translate.instant(t.is_ac_on?"turn-off-all-acs":"turn-on-all-acs"),a=this.translate.instant(t.is_ac_on?"TurnOff":"TurnOn");this.toggle(t,t.name,n,a,!t.is_ac_on,this.toggleACForRoom,o),window.setTimeout(()=>{this.refreshAllRooms()},2e3)}toggleCurtains(t,o=!0){if(this.editmode)return;let n=this.translate.instant(t.is_curtains_open?"close-all-curtains":"open-all-curtains"),a=this.translate.instant(t.is_curtains_open?"close":"open");this.toggle(t,t.name,n,a,!t.is_curtains_open,this.toggleCurtainsForRoom,o),window.setTimeout(()=>{this.refreshAllRooms()},2e3)}toggleFans(t,o=!0){if(this.editmode)return;let n=this.translate.instant(t.is_fan_on?"close-all-fans":"open-all-fans"),a=this.translate.instant(t.is_fan_on?"TurnOff":"TurnOn");this.toggle(t,t.name,n,a,!t.is_fan_on,this.toggleFansForRoom,o),window.setTimeout(()=>{this.refreshAllRooms()},2e3)}getRoomAllDevices(t,o=void 0){let n=t.devices.filter(a=>!a.ExcludeFromRoomControl&&(null==o||null!=o&&a.type!=o));for(let a=0;a<t.children_rooms.length;a++)n=n.concat(this.getRoomAllDevices(t.children_rooms[a],R.Y.DoorSensor));return n}refreshAllRooms(){this.updateRoomsLink().then(t=>{if(this.addedRooms&&this.addedRooms.length)for(let o=0;o<this.addedRooms.length;o++)this.updateRoomInfo(this.addedRooms[o])})}openRoom(t){var o=this;return(0,x.Z)(function*(){let n=yield o.loadingCtrl.create({backdropDismiss:!1,spinner:"crescent"});n.present().then(a=>{console.log("Opening Room....",o.filter),""!=o.filter&&null!=o.filter&&null!=o.filter?o.navCtrl.navigateForward(P.Ak,{state:{data:{room:t,filter:o.filter}}}).then(s=>{n.dismiss()}):"device"===o.next_type&&o.navCtrl.navigateForward(P.Ak,{state:{data:{room:t}}}).then(s=>{n.dismiss()})})})()}ionViewDidEnter(){var t=()=>super.ionViewDidEnter,o=this;return(0,x.Z)(function*(){t().call(o),console.log("ionViewDidEnter RoomsPage"),o.InitializeAllRooms(),clearInterval(o._temp_update_timer2),o._temp_update_timer2=window.setInterval(()=>{o.updateTimer()},1e3),o._delay4sUpdate=()=>{console.log("delay 4s update"),o.delay_update=!1,o.delay_update?(clearTimeout(o.delay_update_timeout),o.delay_update_timeout=window.setTimeout(()=>{o.delay_update=!1,o.refreshAllRooms()},4e3)):o.refreshAllRooms()},o.refreshAllRooms(),b.V0.events.subscribe(N.B.DeviceUpdate.toString(),o._delay4sUpdate);try{o.list_of_rooms=yield h.a.DefaultController.rooms}catch(n){console.error(n)}})()}longPressMouseStart(t,o=1,n=1){let a=c=>{this.touchMoving(c)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",c=>{this.pressEndThing(c),document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",a)}),this.longPressStartThing(t,o,n)}longPressStartThing(t,o=1,n=1){t.preventDefault(),this.yScrollDt="mousedown"==t.type?t.pageY:t.changedTouches[0].pageY,this.longPressDetected=!1,this.longPressCounter=window.setTimeout(()=>{this.longPressDetected=!0,this.ChangeVoiceLanguageThing(o,n)},1e3)}touchMoving(t){t.preventDefault(),Math.abs(this.yScrollDt-("mousemove"==t.type?t.pageY:t.changedTouches[0].pageY))>1&&(this.yScrollDt=0,clearTimeout(this.longPressCounter),this.longPressDetected=!1)}pressEndThing(t,o){t.preventDefault(),clearTimeout(this.longPressCounter),this.longPressDetected&&(this.longPressDetected=!1)}ChangeVoiceLanguageThing(t,o=3){let n=h.a.DefaultController.voiceCommandControl.voice_thing_names.filter(c=>c.thing_id==t&&c.language_id==b.V0.defaultVoiceLanguage.id&&-1!=c.id&&c.thing_type==o),a=[],s=h.a.DefaultController.rooms.find(c=>c.id==t);for(let c=0;c<n.length;c++){if(null==n[c])continue;let v=n[c];v.language_id==b.V0.defaultVoiceLanguage.id&&3==v.thing_type&&a.push({id:v.id,command:""==v.command?null:v.command,lang_id:v.language_id})}console.log(s),this.navCtrl.navigateForward(P.OE,{state:{data:{commands:a,thing:s.translated_name,direction:b.V0.defaultVoiceLanguage.direction,ui_direction:this.platform.isRTL?"rtl":"ltr",language_symbol:b.V0.defaultVoiceLanguage.displaySymbol,language_id:b.V0.defaultVoiceLanguage.id,thing_id:s.id,thing_type:3,is_editmode:this.editmode}}})}compare(t,o){return(t=0==t?999999:t)==(o=0==o?999999:o)?0:t<o?-1:1}toggle_editmode(){this.editmode=!this.editmode,this.enable_reorder||(this.reorderSaveState=!1)}toggle_reorder(){this.addedRooms=this.listOfRooms,this.enable_reorder=!this.enable_reorder,this.enable_reorder?(this.editmode=!0,this.reorderSaveState=!0):(this.editmode=!1,this.reorderSaveState=!1)}add_room(){return(0,x.Z)(function*(){})()}save_reorder(){var t=this;return(0,x.Z)(function*(){for(let n=0;n<t.reorderRoomsIds.length;n++){let a=t.reorderRoomsIds[n],s=t.addedRooms[a.from].sort_order;t.addedRooms[a.from].sort_order=t.addedRooms[a.to].sort_order,t.addedRooms[a.to].sort_order=s}t.reorderRoomsIds=[],t.reorderSaveState=!1,t.editmode=!1,t.enable_reorder=!t.enable_reorder;let o=t.addedRooms.map(n=>n.id);h.a.DefaultController.user.is_super_user?(yield t.alertCtrl.create({header:t.translate.instant("sort-order"),cssClass:"network-alert",message:t.translate.instant("sort-order-for"),buttons:[{text:t.translate.instant("only-me"),role:"exit",handler:()=>{h.a.DefaultController.SetRoomSortOrder(o,!1).then(a=>{t.GetAllRoomsAndResort()})}},{text:t.translate.instant("default"),role:"exit",handler:()=>{console.log("exiting app"),h.a.DefaultController.SetRoomSortOrder(o,!0).then(a=>{t.GetAllRoomsAndResort()})}},{text:t.translate.instant("cancel"),role:"cancel",handler:()=>{t.cancel_reorder()}}],backdropDismiss:!0})).present():h.a.DefaultController.SetRoomSortOrder(o,!1).then(n=>{t.GetAllRoomsAndResort()})})()}reorderArray(t,o){var n=t[o.from];return t.splice(o.from,1),t.splice(o.to,0,n),t}cancel_reorder(){if(this.reorderSaveState)for(let t=0;t<this.reorderRoomsIds.length;t++){let o=this.reorderRoomsIds[t];this.addedRooms=this.reorderArray(this.addedRooms,{from:o.to,to:o.from})}this.reorderRoomsIds=[],this.reorderSaveState=!1,this.enable_reorder=!1,this.editmode=!1}get_default_order(){var t=this;return(0,x.Z)(function*(){(yield t.alertCtrl.create({header:t.translate.instant("sort-order"),cssClass:"network-alert",message:t.translate.instant("do-you-want-default-sort-order"),buttons:[{text:t.translate.instant("yes"),role:"exit",handler:()=>{console.log("Resorting rooms"),h.a.DefaultController.SetDefaultRoomsSortOrder().then(o=>{console.log("Room Initialied"),t.cancel_reorder(),t.InitializeAllRooms()})}},{text:t.translate.instant("no"),role:"cancel",handler:()=>{t.cancel_reorder()}}]})).present()})()}GetAllRoomsAndResort(){h.a.DefaultController.RefreshRoomsOrder().then(t=>{})}reorderItems(t){console.log(t),this.reorderRoomsIds.push({from:t.from,to:t.to}),this.addedRooms=this.reorderArray(this.addedRooms,t)}showOccupancyDialog(t){var o=this;return(0,x.Z)(function*(){const n=yield o.popoverCtrl.create({component:P.Ow,componentProps:{title:o.translate.instant("occupancy"),room:t,occupancy:t.OccupancyState,forcedOccupancy:t.ForceOccupancyState}});n.onDidDismiss().then(function(){var a=(0,x.Z)(function*(s){if(s&&s.data&&void 0!==s.data.occupancy&&void 0!==s.data.forcedOccupancy){const c=yield o.loadingCtrl.create();yield c.present();try{yield t.setOccupancyState(s.data.occupancy,s.data.forcedOccupancy)}catch{}c.dismiss()}});return function(s){return a.apply(this,arguments)}}()),yield n.present()})()}getItems(t){const o=t.target.value;this.addedRooms=o&&o.length>=2?this.listOfRooms.filter(s=>s.translated_name&&s.translated_name.toLowerCase().indexOf(o.toLowerCase())>-1):this.listOfRooms}moveItemUp(t){let o=this.addedRooms.indexOf(t);0!=o&&this.reorderItems({from:o,to:o-1})}moveItemDown(t){let o=this.addedRooms.indexOf(t);o!=this.addedRooms.length-1&&this.reorderItems({from:o,to:o+1})}toggle_hand(){this.disable_hand=!this.disable_hand}reorderItemsEvent(t){t.detail.complete(),this.reorderItems(t.detail)}selectState(t){this.currentState=t}scrollToSelected(){setTimeout(function(){let t=document.getElementsByClassName("alert-radio-group")[0].querySelector('[aria-checked="true"]');t&&setTimeout(function(){t.scrollIntoView()},400)},5)}ngOnInit(){return(0,x.Z)(function*(){})()}onInputChange(t,o){this.SaveRoomInformation(o)}onSelectChange(t,o){this.SaveRoomInformation(o)}}return(r=_).\u0275fac=function(t){return new(t||r)(e.Y36(y.SH),e.Y36(b.V0),e.Y36(y.Br),e.Y36(E.sK),e.Y36(y.t4),e.Y36(e.R0b),e.Y36(y.Dh),e.Y36(z.Z),e.Y36(y.yF),e.Y36(y.HT),e.Y36(y.X1),e.Y36(D.F0),e.Y36(e.sBO),e.Y36(y.IN))},r.\u0275cmp=e.Xpm({type:r,selectors:[["rooms2"]],features:[e.qOj],decls:11,vars:5,consts:[[1,"filter-header"],["size","10",4,"ngIf"],["size","2",4,"ngIf"],["size","12",4,"ngIf"],[3,"disabled","ionItemReorder"],["ion-item","",3,"key",4,"ngFor","ngForOf"],["size","10"],["animated","true","debounce","500",2,"width","100%","padding","0px",3,"placeholder","ionInput"],["size","2"],["style","background: transparent;","ion-button","","clear","","class","top-mic-button-bigger",3,"click",4,"ngIf"],["ion-button","","clear","",1,"top-mic-button-bigger",2,"background","transparent",3,"click"],["name","create",2,"font-size","x-large"],["size","12"],[2,"text-align","end","float","right","min-width","10px"],["slot","end"],["name","add-circle-outline",2,"font-size","x-large"],["name","code",1,"rotate-90",2,"font-size","x-large"],["name","code-working",1,"rotate-90",2,"font-size","x-large"],["name","checkmark",2,"font-size","x-large"],["name","close",2,"font-size","x-large"],["ion-item","",3,"key"],["class","lite-appflow","ion-item","",3,"style",4,"ngIf"],["ion-item","",1,"lite-appflow"],[2,"padding","0px"],["class","room-item",3,"click",4,"ngIf"],["class","room-item",4,"ngIf"],["class","floating-icons",4,"ngIf"],[1,"room-toolbar"],["slot","start"],["class","status-button",3,"class","active","click",4,"ngIf"],["class","reorder-overlay-clear no-pointer",4,"ngIf"],[1,"room-item",3,"click"],["size","12",2,"padding","0px"],[1,"room-item"],[1,"room-info"],[1,"room-name"],["class","room-temperature",4,"ngIf"],[1,"room-temperature"],[2,"width","100%","--background","rgba(0,0,0,.2)","--mybackground-contrast","rgba(0,0,0,.2)"],["type","text","required","",1,"room-name",2,"--background","rgba(0,0,0,.2)","--mybackground-contrast","rgba(0,0,0,.2)","width","100%","margin","auto",3,"ngModel","ngModelChange","ionBlur"],[2,"width","100%","--background","rgba(0,0,0,.2)","--mybackground-contrast","rgba(0,0,0,.2)","background","var(--background)"],["labelPlacement","stacked",1,"room-name",2,"--background","rgba(0,0,0,.2)","--mybackground-contrast","rgba(0,0,0,.2)","margin","auto","width","100%",3,"label","ngModel","click","ngModelChange","ionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[2,"width","100%","--background","rgba(0,0,0,.2)","--mybackground-contrast","rgba(0,0,0,.2)","margin","auto","width","100%"],[1,"room-clear-button",2,"z-index","9999","margin","auto","width","50%","position","absolute","top","100%","left","10px",3,"click"],["slot","end","name","camera"],[1,"floating-icons"],[1,"icon-container"],[1,"room-device-icon",3,"src"],["id","motion-timer",1,"icon-timer"],["id","door-timer",1,"icon-timer"],[1,"icon-container",2,"pointer-events","all",3,"click"],[1,"room-device-icon",2,"background-size","cover",3,"src"],["id","occupancy-timer",1,"icon-timer"],["id","room-temp",1,"icon-timer"],[1,"status-button",3,"click"],[1,"custom-icon",3,"src"],[1,"reorder-overlay-clear","no-pointer"],["ion-button","","clear","",1,"pointer",2,"position","absolute","top","5px","right","20px","width","10px",3,"click"],["name","chevron-up",2,"color","white","border-top","3px solid"],["ion-button","","clear","",1,"pointer",2,"position","absolute","bottom","5px","right","20px","width","10px",3,"click"],["name","chevron-down",2,"color","white","border-bottom","3px solid"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-content")(1,"ion-header")(2,"ion-toolbar")(3,"ion-grid",0)(4,"ion-row"),e.YNc(5,Q,3,3,"ion-col",1),e.YNc(6,V,2,1,"ion-col",2),e.YNc(7,W,8,5,"ion-col",3),e.qZA()()()(),e.TgZ(8,"ion-list")(9,"ion-reorder-group",4),e.NdJ("ionItemReorder",function(a){return o.reorderItemsEvent(a)}),e.YNc(10,de,2,2,"ion-reorder",5),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("ngIf",!o.editmode),e.xp6(1),e.Q6J("ngIf",!o.editmode),e.xp6(1),e.Q6J("ngIf",o.editmode),e.xp6(2),e.Q6J("disabled",o.disable_hand),e.xp6(1),e.Q6J("ngForOf",o.addedRooms))},dependencies:[A.sg,A.O5,S.JJ,S.Q7,S.On,p.YG,p.Sm,p.PM,p.wI,p.W2,p.fr,p.jY,p.Gu,p.gu,p.pK,p.q_,p.Nh,p.oz,p.Nd,p.VI,p.t9,p.n0,p.sr,p.QI,p.j9,U.t,E.X$],styles:[".room2-item-icon[_ngcontent-%COMP%]{margin-inline-end:10px;width:80px;position:relative;vertical-align:middle}.device-icon2[_ngcontent-%COMP%], .room2-item-image[_ngcontent-%COMP%]{border:1px solid gray;padding:5px;background-color:#0000001a;border-radius:3px}.room2-item-image[_ngcontent-%COMP%]{width:23vw;height:23vw;margin:auto}.room2-title[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:xx-large!important;margin:auto!important;width:48vw;overflow:visible;white-space:pre-wrap;text-overflow:ellipsis;word-spacing:normal;display:contents;vertical-align:middle}.room2-detail-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{vertical-align:middle}.room2-item-buttons[_ngcontent-%COMP%]{color:#fff;min-width:20px;text-align:start;height:auto}button.room2-item-buttons[_ngcontent-%COMP%]::part(native){padding:0}.room2-detail-text[_ngcontent-%COMP%]{padding:0 6px;white-space:normal;word-break:normal;text-align:center}.room2-device-icon[_ngcontent-%COMP%]{width:8vw;max-width:64px;font-size:8vw;display:block;vertical-align:middle;margin:auto}.room2-tag[_ngcontent-%COMP%]{color:tomato;font-size:smaller}.room2-forced-occupied[_ngcontent-%COMP%]{-webkit-text-stroke:2px red}.status-button.active[_ngcontent-%COMP%]{--background: #007bff;--color: #fff}._80px[_ngcontent-%COMP%]{margin:0 8px 0 0;width:80px;height:50px;min-height:50px;min-width:50px}._40px[_ngcontent-%COMP%]{width:40px;margin-right:8px;height:40px;min-height:40px;min-width:40px}.room-device-icon[_ngcontent-%COMP%]{max-width:64px;font-size:12px;display:block;vertical-align:middle;margin:auto;filter:none}.room-detail-text[_ngcontent-%COMP%]{font-size:.8em}.room-item-buttons[_ngcontent-%COMP%]{color:#fff;width:80px;min-width:10px;text-align:center;height:80px}.room-item-buttons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:inherit}.device-icon[_ngcontent-%COMP%], .room-item-image[_ngcontent-%COMP%]{border:1px solid gray;padding:5px;background-color:#0000001a;border-radius:3px}.room-item-image[_ngcontent-%COMP%]{width:23vw;height:23vw;margin:auto;max-height:80%}.item[_ngcontent-%COMP%], .item-ios[_ngcontent-%COMP%]{background-color:#5353534d;box-shadow:1px 1px 3px #333;border-radius:3px}ion-card[_ngcontent-%COMP%]{background:var(--ion-background)}ion-card[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{background:none}ion-card[_ngcontent-%COMP%]   ion-footer[_ngcontent-%COMP%]{background:transparent;box-shadow:none}ion-item[_ngcontent-%COMP%]{background:var(--ion-background)}.room-title[_ngcontent-%COMP%]{color:var(--ion-text-color-constrast);text-align:center;font-size:xx-large!important;margin:auto!important;width:48vw;overflow:visible;white-space:pre-wrap;text-overflow:ellipsis;word-spacing:normal;display:flex;flex-direction:row;vertical-align:middle;white-space:nowrap}.room-item[_ngcontent-%COMP%]{position:relative;width:100%;height:40vw;background-size:cover;background-position:center}.room-image[_ngcontent-%COMP%]{width:100%;height:100%}.room-info[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:space-between;padding:10px;background-color:#0000001a}.room-name[_ngcontent-%COMP%]{font-size:5vw;color:#fff}ion-select[_ngcontent-%COMP%]::part(text){font-size:5vw!important;--border-radius: 0px!important}.room-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.transparent-button[_ngcontent-%COMP%]{--background: transparent;--color: #fff}.sensor-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.sensor-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:5px}.sensor-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:5px}.sensor-label[_ngcontent-%COMP%]{margin-right:5px}.sensor-value[_ngcontent-%COMP%]{font-weight:700}.state-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:10px}.state-button[_ngcontent-%COMP%]{--background: transparent;--color: #000;font-size:14px}.state-button.active[_ngcontent-%COMP%]{--background: #007bff;--color: #fff}.status-button[_ngcontent-%COMP%]{--background: transparent;--color: #000;margin-left:5px}.status-button.active[_ngcontent-%COMP%]{--background: --ion-active-color;--color: #fff}.room-image[_ngcontent-%COMP%]{width:100%;height:200px}.room-name[_ngcontent-%COMP%]{font-weight:700}.room-temperature[_ngcontent-%COMP%]{font-size:14px;margin-top:5px;color:var(--ion-text-color-constrast);text-align:start}.room-card[_ngcontent-%COMP%]{background-size:cover;background-position:center;color:--ion-text-color-constrast;height:200px}.room-card[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]{padding:10px}.room-card[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px}.room-toolbar[_ngcontent-%COMP%]{--border-style: none;--ion-toolbar-background: rgba(0, 0, 0, .1)}.custom-icon[_ngcontent-%COMP%]{width:48px;height:48px}ion-footer[_ngcontent-%COMP%]{background-color:unset}.floating-icons[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100}[_ngcontent-%COMP%]:dir(rtl).floating-icons{right:unset;left:10px}.icon-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:10px}.icon-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px;color:--ion-text-color-constrast}.icon-label[_ngcontent-%COMP%]{color:var(--ion-text-color-constrast);font-size:12px;margin-top:5px}.icon-timer[_ngcontent-%COMP%]{color:var(--ion-text-color-constrast);font-size:10px;margin-top:2px}.room-clear-button[_ngcontent-%COMP%]{background:rgba(0,0,0,.2);--background: rgba(0,0,0,.2)}"]}),_})()}];let me=(()=>{var r;class _{}return(r=_).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[D.Bz.forChild(_e),D.Bz]}),_})();var ge=u(23934);let ue=(()=>{var r;class _{}return(r=_).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[A.ez,S.u5,p.Pc,me,ge.o,E.aw]}),_})()}}]);