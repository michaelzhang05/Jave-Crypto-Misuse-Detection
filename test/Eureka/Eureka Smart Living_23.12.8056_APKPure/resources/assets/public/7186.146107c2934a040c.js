"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7186],{87055:(S,m,t)=>{t.d(m,{g:()=>P});const P=(0,t(92726).fo)("App",{web:()=>t.e(2912).then(t.bind(t,62912)).then(f=>new f.AppWeb)})},47186:(S,m,t)=>{t.r(m),t.d(m,{DashboardModePanelPageModule:()=>V});var b=t(96814),P=t(56223),f=t(73582),w=t(70160),v=t(15861),D=t(51141),A=t(69862),C=t(37092),i=t(8873),x=t(37398),L=t(86547),Z=t(5177),R=t(65592),g=t(83895),I=t(87055),e=t(65879),c=t(34414),O=t(88446),T=t(77935),Y=t(11998),E=t(20563),M=t(63999),H=t(9482);function N(s,d){1&s&&(e.TgZ(0,"div",7),e._UZ(1,"div",8),e.qZA())}function j(s,d){if(1&s){const l=e.EpF();e.TgZ(0,"div",9)(1,"div",10),e.NdJ("click",function(){e.CHM(l);const a=e.oxw();return e.KtG(a.showDetailedMessage())}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&s&&(e.xp6(2),e.hij(" \xa0",e.lcZ(3,1,"details...")," "))}const F=[{path:"",component:(()=>{var s;class d{get AppIcon(){return window.devicePixelRatio<=1?C.Y.appLogoXSmall:C.Y.appLogo}constructor(o,a,n,r,p,J,B,z,W,Q,X,h){this.navCtrl=o,this.platform=a,this.navProvider=n,this.http=r,this.settings=p,this.jsonRPC=J,this.dataAPI=B,this.translate=z,this.events=W,this.alertCtrl=Q,this.viewCtrl=X,this.navParams=h,this.main_message="connecting",this.dashboardError=g.H.Unknown,this.dashboardId=-1,this.just_dismiss=!1,this.sub_message="trying-to-connect-to-eslbox",this.dmShow=!1,this.background_working=!1,this.theAppState=i.a,this.home_timeout_id=-1,this.previousSubscription=void 0,this.skipScanningIntervalId=-1;let k=h.get("dashboard-error");null!=k&&(this.dashboardError=k),this.dashboardId=h.get("dashboard-id"),this.callback=h.get("callback"),this.just_dismiss=h.get("just_dismiss");let y=h.get("detailed_message");y&&(this.detailed_message=y);let u=h.get("message");this.message=u instanceof A.Zn?u&&u.body&&u.body.result?u.statusText:"Dashboard not found!":h.get("message"),this.events.subscribe("resume",this.AppResumed),this.events.subscribe("pause",this.AppPaused)}AppResumed(){this.events.unsubscribe("resume"),this.events.subscribe("pause",this.AppPaused),console.log("Dashboard Mode Resume"),this.forceRefresh()}AppPaused(){console.log("Dashboard Mode Pause"),this.events.subscribe("resume",this.AppResumed),this.events.unsubscribe("pause",this.AppPaused)}ionViewDidLeave(){window.clearInterval(this.skipScanningIntervalId),console.log("ionViewDidLeave DashboardModePanelPage")}ionViewWillLeave(){window.clearInterval(this.skipScanningIntervalId),console.log("ionViewWillLeave DashboardModePanelPage")}ionViewDidEnter(){console.log("ionViewDidEnter DashboardModePanelPage")}ionViewDidLoad(){switch(this.platform.backButton.subscribeWithPriority(101,()=>{I.g.minimizeApp()}),console.log("ionViewDidLoad DashboardModePanelPage"),this.dashboardError){case g.H.NotLogin:this.performRepeatedLoginAtempt();break;case g.H.DashboardNotFound:this.sub_message="",this.main_message="no-dashboard-found";break;case g.H.NetworkError:this.performRepeatedLoginAtempt();break;default:this.main_message="unknown",this.sub_message="",this.performRepeatedLoginAtempt()}}SecretFunctionStart(){console.debug("secret functionality start"),window.clearTimeout(this.home_timeout_id),this.home_timeout_id=window.setTimeout(()=>{this.just_dismiss?this.dismissSelf():this.setHomePageAsMain()},3e3)}SecretFunctionCancel(){console.debug("cancelling secret functionality"),window.clearTimeout(this.home_timeout_id)}setLoginPageAsMain(){var o=this;return(0,v.Z)(function*(){yield o.navProvider.setRoot(D.g6),console.log("calling dismiss, on setLoginPageAsMain"),o.dismissSelf()})()}setHomePageAsMain(){var o=this;return(0,v.Z)(function*(){yield o.navProvider.setRoot(i.a.mainPage),console.log("calling dismiss, on setHomePageAsMainPage"),o.dismissSelf()})()}showDetailedMessage(){var o=this;return(0,v.Z)(function*(){(yield o.alertCtrl.create({message:o.translate.instant(o.detailed_message),buttons:[{text:o.translate.instant("close"),role:"cancel"}]})).present()})()}forceRefresh(){switch(this.dashboardError){case g.H.NotLogin|g.H.NetworkError:console.log("retrying to login"),i.a.DefaultController.AuthenticateSilent().then(o=>{this.performRepeatedLoginAtempt()});break;case g.H.DashboardNotFound:console.log("retry to load dashboard, not found"),this.RetryLoadingDashboard()}}RetryLoadingDashboard(){this.background_working=!0;let a={};i.a.DashboardId>-1&&i.a.DashboardMode&&(a={dashboard_id:i.a.DashboardId,first_load:!0}),this.navCtrl.navigateRoot(D.so,{state:{data:a}}).then(n=>{this.background_working=!1,console.warn("view dismiss"),this.dismissSelf()},n=>{this.background_working=!1,console.warn("view dismiss"),this.dismissSelf(),console.error(n)}).catch(n=>{this.background_working=!1,console.log("view dismiss"),this.dismissSelf(),console.error(n)})}performRepeatedLoginAtempt(o=1e4){if(i.a.DefaultController&&i.a.DefaultController.is_login)return void(this.background_working=!1);this.previousSubscription&&(this.background_working=!1,console.debug("Cancelling all previous Subscription",this.previousSubscription),this.previousSubscription.unsubscribe()),this.background_working=!0;let n=new R.y(r=>{i.a.DefaultController.LoginV2(i.a.DefaultController.username,i.a.DefaultController.password,i.a.DefaultController.serial_no,this.jsonRPC,this.dataAPI,this.settings).then(p=>{r.next(p),this.setLoginPageAsMain(),r.complete()},p=>{r.error(p)})}).pipe((0,x.U)(r=>{console.log("logged in successfully",r)}),(0,L.a)(r=>(this.background_working=!0,r.pipe((0,Z.g)(o)))));this.previousSubscription=n.subscribe(r=>{console.debug("Login pipeline finished",r),this.dismissSelf()})}dismissSelf(){var o=this;return(0,v.Z)(function*(){console.log("dismissing self"),yield o.viewCtrl.dismiss()})()}}return(s=d).\u0275fac=function(o){return new(o||s)(e.Y36(c.SH),e.Y36(c.t4),e.Y36(O.Y),e.Y36(A.eN),e.Y36(T.Z),e.Y36(Y.p),e.Y36(E.Q),e.Y36(M.sK),e.Y36(H.z),e.Y36(c.Br),e.Y36(c.IN),e.Y36(c.X1))},s.\u0275cmp=e.Xpm({type:s,selectors:[["dashboard-mode-panel"]],decls:13,vars:11,consts:[[2,"width","100%","margin-top","30px","display","inline-block","text-align","center"],[2,"padding-top","5px","width","150px",3,"src"],["padding","",2,"text-align","center","top","50%","min-height","100%","position","absolute","width","100%","transform","translateY(-18vw)",3,"touchstart","touchend"],[2,"width","auto","display","inline-block","padding-top","10px"],["class","progress",4,"ngIf"],["name","refresh",2,"font-size","100px","animation","spin 2s linear infinite",3,"click"],["style","position:absolute; bottom:10px; padding:5px 10px;",4,"ngIf"],[1,"progress"],[1,"indeterminate"],[2,"position","absolute","bottom","10px","padding","5px 10px"],[2,"text-align","start",3,"click"]],template:function(o,a){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"img",1),e.qZA(),e.TgZ(2,"div",2),e.NdJ("touchstart",function(){return a.SecretFunctionStart()})("touchend",function(){return a.SecretFunctionCancel()}),e.TgZ(3,"div",3)(4,"h1"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.YNc(7,N,2,0,"div",4),e.qZA(),e.TgZ(8,"p"),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"ion-icon",5),e.NdJ("click",function(){return a.forceRefresh()}),e.qZA()(),e.YNc(12,j,4,3,"div",6)),2&o&&(e.xp6(1),e.Q6J("src",a.AppIcon,e.LSH),e.xp6(4),e.Oqu(e.lcZ(6,7,a.main_message)),e.xp6(2),e.Q6J("ngIf",a.background_working),e.xp6(2),e.Oqu(e.lcZ(10,9,a.sub_message)),e.xp6(2),e.Udp("animation",a.background_working?"spin 2s linear infinite":""),e.xp6(1),e.Q6J("ngIf",a.detailed_message))},dependencies:[b.O5,f.gu,M.X$],styles:["ion-popover[_ngcontent-%COMP%]::part(content){max-height:100%;overflow:hidden;width:100%;height:100%;top:0!important;left:0!important;position:absolute}.dashboard-block-view[_ngcontent-%COMP%]   .popover-wrapper[_ngcontent-%COMP%]{background:#333;height:100%;width:100%}.dashboard-block-view[_ngcontent-%COMP%]   .popover-content[_ngcontent-%COMP%]{max-height:100%;overflow:hidden;width:100%;height:100%;top:0!important;left:0!important;position:absolute}.dashboard-block-view[_ngcontent-%COMP%]   ion-popover[_ngcontent-%COMP%]{--background: rgba(40, 173, 218, .6);--backdrop-opacity: .6;--box-shadow: 0 5px 10px 0 rgba(0, 0, 0, .6);--color: white;--width: 300px}.dashboard-block-view[_ngcontent-%COMP%]   ion-popover[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: rgba(40, 173, 218, .6)}.dashboard-block-view[_ngcontent-%COMP%]   ion-popover[_ngcontent-%COMP%]::part(backdrop){background-color:#060e6a}"]}),d})()}];let U=(()=>{var s;class d{}return(s=d).\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[w.Bz.forChild(F),w.Bz]}),d})(),V=(()=>{var s;class d{}return(s=d).\u0275fac=function(o){return new(o||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[b.ez,P.u5,f.Pc,U,M.aw.forChild()]}),d})()}}]);