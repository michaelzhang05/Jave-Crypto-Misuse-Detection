"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8009],{8009:(ee,T,i)=>{i.r(T),i.d(T,{PerformLoginPageModule:()=>Q});var _=i(96814),H=i(56223),v=i(73582),R=i(70160),f=i(15861),D=i(19462),A=i(37092),o=i(8873),d=i(46729),r=i(68023),M=i(51141),F=i(22096),k=i(5177),C=i(73638),p=i(11998),I=i(44966),N=i(15231),y=i(86971),E=i(28662),V=i(15697),b=i(43248),t=i(65879),L=i(34414),Z=i(74528),w=i(58646),S=i(63999),U=i(88446),z=i(77935),Y=i(54192);function B(a,l){1&a&&(t.TgZ(0,"div",11),t._UZ(1,"ion-progress-bar",12),t.qZA())}function W(a,l){if(1&a){const h=t.EpF();t.TgZ(0,"span",14),t.NdJ("click",function(){t.CHM(h);const e=t.oxw(2);return t.KtG(e.showDetailedMessage())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"details...")))}function G(a,l){if(1&a){const h=t.EpF();t._UZ(0,"br"),t.YNc(1,W,3,3,"span",13),t._UZ(2,"hr"),t.TgZ(3,"button",10),t.NdJ("click",function(){t.CHM(h);const e=t.oxw();return t.KtG(e.forceRetry())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}if(2&a){const h=t.oxw();t.xp6(1),t.Q6J("ngIf","failed"==h.state),t.xp6(2),t.Udp("opacity",h.disableForceRetry?.4:1),t.xp6(1),t.Oqu(t.lcZ(5,4,"retry"))}}const J=[{path:"",component:(()=>{var a;class l{constructor(n,e,s,c,g,u,m,P,X,j,$,O,q){if(this.navCtrl=n,this.alertCtrl=e,this.connection=s,this.toastCtrl=c,this.uuid=g,this.translate=u,this.platform=m,this.api=P,this.navigationCtrl=X,this.activatedRouter=j,this.settings=$,this.router=O,this.splashScreen=q,this.IMAGES=D.s.Images,this.title="...",this.mainMessage="",this.detailedMessage="",this.manualLogin=!1,this.state="normal",this.theAppState=o.a,this.device_manufacturer="",this.device_model="",this.device_platform="",this.disableLoginPageBtn=!1,this.disableForceRetry=!1,o.a.platform=this.platform,this.state="failed",d.V0.events.unsubscribe("network-lost",this.networkLost),d.V0.events.unsubscribe("network-connected",this.networkConnected),d.V0.events.subscribe("network-lost",this.networkLost),d.V0.events.subscribe("network-connected",this.networkConnected),O.getCurrentNavigation().extras.state){const x=this.router.getCurrentNavigation().extras.state;this.manualLogin=x.data.manualLogin,this.controllers=o.a.controllers,this.account=x.data.account}}ngOnInit(){var n=this;return(0,f.Z)(function*(){try{const e=yield E.A.getInfo();n.device=e,n.device_manufacturer=n.device.manufacturer,n.device_model=n.device.model,n.device_platform=n.device.platform;const s=yield E.A.getId();n.deviceId=s.identifier}catch(e){console.log("error on geting device information "+e)}console.log("ionViewDidEnter PerformLoginPage"),d.V0.events.unsubscribe("pause",n.minimizeHandler),d.V0.events.unsubscribe("resume",n.restorehandler),d.V0.events.subscribe("pause",n.minimizeHandler),d.V0.events.subscribe("resume",n.restorehandler),yield n.login(),o.a.DefaultController&&n.ReadyAndOpenMainPage(),n.platform.ready().then(()=>{o.a.IsCapacitor=n.platform.is("capacitor"),o.a.IsCapacitor&&n.splashScreen.hide()})})()}assignProperty(n,e,s){e[s]=n[s]}assignProperties(n,e){for(let s in n)n.hasOwnProperty(s)&&this.assignProperty(n,e,s)}getSettings(){var n=this;return(0,f.Z)(function*(){yield n.settings.load(),n.settings.getValue("lastcontroller").then(e=>{if(e){const s=JSON.parse(e);let c=new V.Q(s._name,s._localIP,s._publicIP,s.initialize,s.serial_no,s.fields);n.assignProperties(s,c)}})})()}minimizeHandler(){console.log("app is minimized"),l.isAppPause=!0}restorehandler(){l.isAppPause=!1,console.log("app is restored"),l.lastRequestFinished&&(this.retry_observable=this.RetryLoginWithDelay())}RetryLoginWithDelay(n=5){return n<1&&(n=1),(0,F.of)(1).pipe((0,k.g)(1e3*n)).subscribe(e=>{l.isAppPause||this.RetryLogin()})}ionViewDidEnter(){}ionViewWillLeave(){console.log("ionViewWillLeave PerformLoginPage"),d.V0.events.unsubscribe("pause",this.minimizeHandler),d.V0.events.unsubscribe("resume",this.restorehandler),d.V0.events.unsubscribe("network-lost",this.networkLost),d.V0.events.unsubscribe("network-connected",this.networkConnected)}networkConnected(){this.forceRetry()}networkLost(){console.debug("Network lost")}goBack(){}get AppIcon(){return window.devicePixelRatio<=1?A.Y.appLogoXSmall:A.Y.appLogo}showLoginPage(){console.log("Navigating to login page"),this.disableLoginPageBtn=!0,this.retry_observable&&!this.retry_observable.closed&&this.retry_observable.unsubscribe(),p.p.cancelFurtherRequests=!0,o.a.coming_from_perform_login=!0,this.navCtrl.navigateRoot(M.g6,{state:{stop_performing_login:!0}}).then(()=>{this.disableLoginPageBtn=!1})}showDetailedMessage(){var n=this;return(0,f.Z)(function*(){(yield n.alertCtrl.create({header:n.translate.instant("details"),message:n.detailedMessage,buttons:[{text:n.translate.instant("ok"),role:"cancel"}]})).present()})()}forceRetry(){this.disableForceRetry||(this.disableForceRetry=!0,this.retry_observable&&!this.retry_observable.closed?this.retry_observable.unsubscribe():(l.lastRequestFinished=!1,this.retry_observable=this.RetryLoginWithDelay(),l.lastRequestFinished=!0),setTimeout(()=>{this.disableForceRetry=!1},3e3))}login(n=!1){var e=this;return(0,f.Z)(function*(){e.title=e.translate.instant("loading"),e.mainMessage="",e.detailedMessage="",e.state="normal";var s=yield e.connection.GetDefaultController();s&&(e.title=e.translate.instant("connecting"),e.mainMessage=e.translate.instant("to")+" "+s.name,s.serial_no&&(e.detailedMessage=e.translate.instant("serial-no")+`${s.serial_no}`),console.debug("Connection permission from default",s.connection_permission),null==s.connection_permission?(console.log("no connectin permission found considering both"),o.a.ConnectionPermission=C.T.Both):o.a.ConnectionPermission=s.connection_permission,o.a.ConnectionPermission==C.T.Both&&(console.warn("Both Types of connection allowed"),p.p.switchToLocalConnection()),o.a.ConnectionPermission==C.T.Local?(console.warn("Only local connection allowed"),p.p.switchToLocalConnection()):o.a.ConnectionPermission==C.T.Remote?(console.warn("Only remote connection allowed"),p.p.switchToRemoteConnection()):e.platform.is("mobile")?o.a.NetworkType==I.t.NETWORK_WIFI||o.a.NetworkType==I.t.NETWORK_ETHERNET||o.a.NetworkType==I.t.NETWORK_UNKNOWN?p.p.switchToLocalConnection():p.p.switchToRemoteConnection():p.p.switchToLocalConnection()),e.ReadyAndOpenMainPage(),console.log("start login");var c=yield e.connection.Login(void 0,e.manualLogin);switch(console.log("end login:"+c),c){case r.H.MISSING_CREDENTIALS:e.showLoginPage();break;case r.H.LOGIN_SUCCESS:e.showMainPage();break;case r.H.INVALID_CREDENTIALS:e.title=e.translate.instant("wrong-username-password"),e.mainMessage=e.translate.instant("invalid-credentials"),e.detailedMessage=e.translate.instant("please-verify-credentials-or-reenter"),e.state="failed";let g=e.GetAllControllerSaveModel(),u=g.find(m=>m.mac_id==o.a.DefaultController.mac_id);u&&(u.remember=!1,u.username="",u.password="",yield e.settings.setValue("controllers",g));break;case r.H.CONNECTION_ERROR:e.title=e.translate.instant("connection-error"),e.mainMessage=e.translate.instant("unable-to-connect-to-esl"),e.detailedMessage=e.translate.instant("make-sure-that-your-esl-box-is-connected-to-the-network-if-your-are-using-it-remotely-then-your-box-and-current-device-must-be-connected-to-the-internet"),e.state="failed";break;case r.H.NO_NETWORK:e.title=e.translate.instant("no-network"),e.mainMessage=e.translate.instant("check-your-network-connection"),e.detailedMessage=e.translate.instant("please-enable-network-on-this-device-to-access-esl"),e.state="failed";break;case r.H.SYSTEM_ERROR:e.title=e.translate.instant("system-unavailable"),e.mainMessage=e.translate.instant("esl-need-refresh"),e.detailedMessage=e.translate.instant("if-esl-is-just-restarted-wait"),e.state="failed";break;case r.H.REQUEST_SEND_FOR_ACCESS:e.title=e.translate.instant("request_sent"),e.mainMessage=e.translate.instant("require_access_permission"),e.detailedMessage=e.translate.instant("this_esl_box_require_permission_for_login"),e.state="failed";break;case r.H.UNAUTHORIZED:e.title=e.translate.instant("unauthorized"),e.mainMessage=e.translate.instant("login-blocked-for-this-user"),e.detailedMessage=e.translate.instant("your-credentials-are-blocked-on-this-esl-box"),e.state="failed";break;case r.H.INVALID_SERIAL_NUMBER:e.title=e.translate.instant("invalid_serial_number"),e.mainMessage=e.translate.instant("required_valid_serial_number"),e.detailedMessage=e.translate.instant("required_valid_serial_number"),e.state="failed";break;case r.H.MISSING_HARDWARE_ID:e.title=e.translate.instant("missing_hardware_id"),e.mainMessage=e.translate.instant("unable_to_send_hardware_id_for_login"),e.detailedMessage=e.translate.instant("this_device_is_to_unable_to_send_hardware_id"),e.state="failed";break;case y.S.TIMEOUT:e.title=y.S.TIMEOUT,e.mainMessage=e.translate.instant("unable-to-connect-to-esl"),e.detailedMessage=e.translate.instant("make-sure-that-your-esl-box-is-connected-to-the-network-if-your-are-using-it-remotely-then-your-box-and-current-device-must-be-connected-to-the-internet"),e.state="failed";break;default:e.title=e.translate.instant("unhandled_error"),e.mainMessage=e.translate.instant("unhandled_error"),e.detailedMessage=e.translate.instant("unhandled_error"),e.state="failed"}"failed"==e.state&&(l.lastRequestFinished=!1,e.retry_observable=e.RetryLoginWithDelay(),l.lastRequestFinished=!0)})()}GetAllControllerSaveModel(){let n=[];for(let e=0;e<this.controllers.length;e++)n.push({name:this.controllers[e].name,ip:this.controllers[e].localIP,publicIP:this.controllers[e].publicIP,isSelected:this.controllers[e].isSelected,username:this.controllers[e].username,remember:this.controllers[e].remember,password:this.controllers[e].password,mac_id:this.controllers[e].mac_id,serial_no:this.controllers[e].serial_no,connection_permission:this.controllers[e].connection_permission,hide_in_selection:this.controllers[e].hide_in_selection});return n}RetryLogin(){var n=this;return(0,f.Z)(function*(){console.debug("Retrying...");let e=!1;switch(l.lastRequestFinished=!1,p.p.RequireScanning=!0,yield n.connection.Login()){case r.H.CONNECTION_ERROR:case r.H.NO_NETWORK:case r.H.SYSTEM_ERROR:e=!0;break;case r.H.LOGIN_SUCCESS:return e=!1,void n.showMainPage();case r.H.MISSING_CREDENTIALS:case r.H.ESL_NOT_FOUND:case r.H.INVALID_CREDENTIALS:case r.H.REQUEST_SEND_FOR_ACCESS:case r.H.UNAUTHORIZED:e=!1;break;case r.H.INVALID_SERIAL_NUMBER:case r.H.MISSING_HARDWARE_ID:case r.H.FUNCTIONALITY_NOT_FOUND:return void(e=!1);default:e=!0}l.lastRequestFinished=!0,n.retry_observable=n.RetryLoginWithDelay()})()}showToast(n){var e=this;return(0,f.Z)(function*(){(yield e.toastCtrl.create({message:n,duration:2e3,position:"bottom"})).present()})()}showMainPage(){this.retry_observable&&this.retry_observable.unsubscribe(),this.InitializeFirebasePlugin(),this.showToast(this.translate.instant("login-success"))}ReadyAndOpenMainPage(){var n=this;this.readyPageHandler&&(d.V0.events.unsubscribe(N.B.AllReady,this.readyPageHandler),this.readyPageHandler=void 0),this.readyPageHandler=(0,f.Z)(function*(){let e=o.a.mainPage,s={};if(o.a.DashboardId>-1&&o.a.DashboardMode)e=M.so,s={dashboard_id:o.a.DashboardId,first_load:!0};else if("dashboard"==n.navigationCtrl.pagesToLoadFromHome&&"dashboard"==n.navigationCtrl.pagesToLoadFromHome){var g=yield o.a.DefaultController.GetDashboards();if(g&&g&&g.body&&g.body.result&&g.body.result.length){let m=g.body.result.find(P=>n.navigationCtrl.name&&P.Name&&P.Name.toLowerCase()==n.navigationCtrl.name.toLowerCase()||P.Id==n.navigationCtrl.id);m&&(e=M.so,console.warn("setting dahsboard page from the query param"),s={dashboard_id:m.Id,first_load:!0})}}let u={};u=s||{},n.navCtrl.navigateRoot(e,{state:{data:u}}).then(m=>{},m=>{console.error(m)}).catch(m=>{console.error(m)}),d.V0.events.unsubscribe(N.B.AllReady,n.readyPageHandler)}),d.V0.events.subscribe(N.B.AllReady,this.readyPageHandler)}InitializeFirebasePlugin(){var n=this;return(0,f.Z)(function*(){try{d.V0.events.unsubscribe(y.S.INVALID_SERIAL),d.V0.events.unsubscribe(y.S.BLOCKED_HARDWARE),console.log("Checking if cordova available",n.platform.platforms()),n.platform.is("capacitor")&&(b.V?yield b.V.checkPermissions().then(function(){var e=(0,f.Z)(function*(s){"granted"==s.receive?(console.log("SAS Perform Login Firebase permission granted"),n.initializePushNotificationService()):(console.log("SAS Perform Login Firebase permission not granted yet-requesting"),yield b.V.requestPermissions().then(function(){var c=(0,f.Z)(function*(g){"granted"==g.receive?(console.log("SAS Perform Login Firebase permission granted"),n.initializePushNotificationService()):console.log("SAS Perform Login Firebase permission not granted")});return function(g){return c.apply(this,arguments)}}()))});return function(s){return e.apply(this,arguments)}}(),e=>{console.error("Firebase loading error",e)}):console.warn("No firebase found"))}catch(e){console.error("Error: Firebase Initialize Error",e),n.showToast("Error: Firebase Initialize Error"+e)}})()}initializePushNotificationService(){var n=this;return(0,f.Z)(function*(){console.log("Initializing Firebase"),n.platform.is("capacitor")?(yield function(){var s=(0,f.Z)(function*(){yield b.V.addListener("registration",c=>{console.info("Registration token: ",c.value),n.uuid.get().then(g=>{console.log("Firebase UUID found"+g.identifier),console.log("manufacturer:"+n.device.manufacturer+"/model"+n.device.model,"identifier"+g.identifier,0,"token:"+c.value),o.a.DefaultController.RegisterForPushNotification(n.device.manufacturer+"/"+n.device.model,g.identifier,0,c.value).then(u=>{console.log("Registered mobile FCM x: "+u)}).catch(u=>{console.error("Unable to register mobile FCM",u)})})}),yield b.V.addListener("registrationError",c=>{console.error("Registration error: ",c.error)}),yield b.V.addListener("pushNotificationReceived",c=>{console.log("Push notification received: ",c)}),yield b.V.addListener("pushNotificationActionPerformed",c=>{console.log("Push notification action performed",c.actionId,c.inputValue)})});return function(){return s.apply(this,arguments)}}()(),yield b.V.register()):console.warn("No Cordova found.")})()}showNotificationToast(n,e=3e3){var s=this;return(0,f.Z)(function*(){(yield s.toastCtrl.create({message:n,cssClass:"notif-toast",duration:e,position:"bottom",buttons:[{text:s.translate.instant("ok")}]})).present()})()}}return(a=l).isAppPause=!1,a.lastRequestFinished=!1,a.\u0275fac=function(n){return new(n||a)(t.Y36(L.SH),t.Y36(L.Br),t.Y36(Z.U),t.Y36(L.yF),t.Y36(w.i),t.Y36(S.sK),t.Y36(L.t4),t.Y36(d.V0),t.Y36(U.Y),t.Y36(R.gz),t.Y36(z.Z),t.Y36(R.F0),t.Y36(Y.c))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-perform-login"]],decls:17,vars:12,consts:[[2,"margin-top","15px","text-align","center"],[2,"padding-top","5px","margin-right","10px",3,"src"],[3,"fullscreen"],[1,"content"],[3,"src"],["id","title",2,"margin-bottom","0"],["id","main_message"],["class","progress",4,"ngIf"],[3,"ngIf"],[1,"footer"],[1,"outline-button",3,"click"],[1,"progress"],["type","indeterminate"],["class","simple-button","style","display:inline-block;",3,"click",4,"ngIf"],[1,"simple-button",2,"display","inline-block",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",0),t._UZ(3,"img",1),t.qZA()()(),t.TgZ(4,"ion-content",2)(5,"div",3),t._UZ(6,"img",4),t.TgZ(7,"h4",5),t._uU(8),t.qZA(),t.TgZ(9,"span",6),t._uU(10),t.qZA(),t.YNc(11,B,2,0,"div",7),t.YNc(12,G,6,6,"ng-template",8),t.qZA(),t.TgZ(13,"div",9)(14,"ion-button",10),t.NdJ("click",function(){return e.showLoginPage()}),t._uU(15),t.ALo(16,"translate"),t.qZA()()()),2&n&&(t.xp6(3),t.Q6J("src",e.AppIcon,t.LSH),t.xp6(1),t.Q6J("fullscreen",!0),t.xp6(2),t.Q6J("src",e.IMAGES.app_logo,t.LSH),t.xp6(2),t.Oqu(e.title),t.xp6(2),t.Oqu(e.mainMessage),t.xp6(1),t.Q6J("ngIf","normal"==e.state),t.xp6(1),t.Q6J("ngIf","failed"==e.state),t.xp6(2),t.Udp("opacity",e.disableLoginPageBtn?.4:1),t.xp6(1),t.Oqu(t.lcZ(16,10,"account")))},dependencies:[_.O5,v.YG,v.W2,v.Gu,v.X7,v.wd,v.sr,S.X$],styles:[".content[_ngcontent-%COMP%]{width:100%;height:100%;text-align:center}.content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:35vh}.footer[_ngcontent-%COMP%]{position:absolute;bottom:35px;left:50%;transform:translate(-50%);font-size:small;height:30px}.footer[_ngcontent-%COMP%]   .button-clear-md[_ngcontent-%COMP%]{color:#fff;font-size:small}.simple-button[_ngcontent-%COMP%]{border-radius:5px;text-decoration:underline;width:auto;padding:5px 10px;font-size:small;display:inline-block;margin:3px}.simple-button[_ngcontent-%COMP%]:active{filter:brightness(1.4)}.clear-border[_ngcontent-%COMP%]{min-width:80px}.outline-button[_ngcontent-%COMP%]{font-size:small;background:0 0;border:1px solid #fff;color:#fff;text-transform:capitalize;padding:5px 10px;margin:5px;border-radius:5px;font-variant:all-small-caps}ion-progress-bar[_ngcontent-%COMP%]::part(track){background:transparent}ion-progress-bar[_ngcontent-%COMP%]::part(progress){background:white}"]}),l})()}];let K=(()=>{var a;class l{}return(a=l).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[R.Bz.forChild(J),R.Bz]}),l})(),Q=(()=>{var a;class l{}return(a=l).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({providers:[w.i],imports:[_.ez,H.u5,v.Pc,K,S.aw]}),l})()}}]);