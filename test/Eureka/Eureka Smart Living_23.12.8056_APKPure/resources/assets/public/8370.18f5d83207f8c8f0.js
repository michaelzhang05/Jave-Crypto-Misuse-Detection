"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8370],{48370:(E,R,d)=>{d.r(R),d.d(R,{RoomOccupancyActionPageModule:()=>K});var u=d(96814),v=d(56223),l=d(73582),A=d(70160),m=d(15861),p=d(28002),o=d(8873),y=d(17229),h=d(83050),x=d(31138),t=d(65879),O=d(34414),Z=d(88446),f=d(63999),P=d(59764),T=d(48753),b=d(82576),w=d(69705),U=d(73290);function J(c,s){if(1&c&&(t._UZ(0,"div",12),t.ALo(1,"sanitizeHtml")),2&c){const a=t.oxw();t.Q6J("innerHtml",t.lcZ(1,1,a.action.action.description),t.oJD)}}function M(c,s){if(1&c&&(t._UZ(0,"div",14),t.ALo(1,"sanitizeHtml")),2&c){const a=t.oxw().$implicit;t.Q6J("innerHtml",t.lcZ(1,1,a.description),t.oJD)}}function D(c,s){if(1&c){const a=t.EpF();t.TgZ(0,"div",8)(1,"div",9),t.YNc(2,M,2,3,"div",13),t.qZA(),t.TgZ(3,"div",3)(4,"button",4),t.NdJ("click",function(){const e=t.CHM(a).$implicit,r=t.oxw();return t.KtG(r.editCondition(e))}),t._UZ(5,"ion-icon",5),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){const e=t.CHM(a).$implicit,r=t.oxw();return t.KtG(r.removeCondition(e))}),t._UZ(7,"ion-icon",6),t.qZA()()()}if(2&c){const a=s.$implicit;t.xp6(2),t.Q6J("ngIf",null==a?null:a.description)}}let S=(()=>{var c;class s{constructor(n,i,e,r){this.navCtrl=n,this.alertCtrl=i,this.zone=e,this.translate=r,this.EditedChange=new t.vpe,this.actionChange=new t.vpe,this.roomActionChange=new t.vpe,console.log("Hello OccupancyRoomActionComponent Component"),this.descriptionGen=new b.q(r)}ngAfterViewInit(){window.setTimeout(()=>{this.UpdateOccupancyActionDescription(this.action)})}UpdateOccupancyActionDescription(n){this.action&&this.action.action&&(this.descriptionGen.UpdateOccupancyActionDescription(n),this.zone.run(()=>{console.debug("forceful update")}))}write(n,i,e){let r=e.split(":");if(3==r.length){let g=parseInt(r[0]),_=parseInt(r[1]),C=parseInt(r[2]);n[i]=C+60*_+3600*g,console.log(e,n[i])}}removeCondition(n){var i=this;return(0,m.Z)(function*(){(yield i.alertCtrl.create({cssClass:"network-alert",header:i.translate.instant("delete")+" - "+i.translate.instant("condition"),message:i.translate.instant("are-you-sure-you-want-to-delete"),buttons:[{text:i.translate.instant("yes"),handler:e=>{let r=i.action.conditions.indexOf(n);if(r>-1){i.EditedChange.emit("Changed"),i.action.conditions.splice(r,1);let g=o.a.roomOccupancyAction.actions.indexOf(i.action);g>-1&&(o.a.roomOccupancyAction.actions[g]=i.action)}}},{text:i.translate.instant("no"),role:"cancel"}]})).present()})()}removeAction(){var n=this;return(0,m.Z)(function*(){(yield n.alertCtrl.create({cssClass:"network-alert",header:n.translate.instant("delete")+" - "+n.translate.instant("action"),message:n.translate.instant("are-you-sure-you-want-to-delete"),buttons:[{text:n.translate.instant("yes"),handler:i=>{let e=n.roomAction.actions.indexOf(n.action);e>-1&&(n.EditedChange.emit("Changed"),n.roomAction.actions.splice(e,1),o.a.roomOccupancyAction=n.roomAction)}},{text:n.translate.instant("no"),role:"cancel"}]})).present()})()}editAction(){this.EditedChange.emit("Changed"),o.a.ROAEO=new h.r,o.a.ROAEO.roomOccupancyActionAction=this.action;let n=this.action.action.onOccupied;o.a.ROAEO.mode="edit",o.a.ROAEO=o.a.ROAEO,o.a.oaction=this.action,o.a.oonOccupied=n,o.a.odata={ROAEO:o.a.ROAEO,action:this.action,edit:!0},o.a.oEditAction=this.action,this.navCtrl.navigateForward("ActionOrPropertyPage")}addCondition(){this.EditedChange.emit("Changed"),this.action.conditions||(this.action.conditions=[]);let n=new p.gP;o.a.ROAEO=new h.r,o.a.ROAEO.actionOrCondition="condition",o.a.ROAEO.roomOccupancyActionCondition=new p.gP,o.a.roomOccupancyActionAction=this.action,o.a.ROAEO=o.a.ROAEO,o.a.oaction=this.action,this.navCtrl.navigateForward("RoomOccupancyConditionEditPage",{queryParams:{edit:!1,ROAEO:o.a.ROAEO,condition:n},state:{data:{edit:!1,ROAEO:o.a.ROAEO,condition:n}}})}editCondition(n){o.a.ROAEO.roomOccupancyActionAction=this.action,this.EditedChange.emit("Changed"),o.a.ROAEO=new h.r,o.a.ROAEO.actionOrCondition="condition",o.a.ROAEO.mode="edit",o.a.ROAEO.roomOccupancyActionCondition=n,o.a.oEditCondition=o.a.ROAEO.roomOccupancyActionCondition,o.a.roomOccupancyActionAction=this.action,o.a.ROAEO=o.a.ROAEO,n.conditionType==y.oS.DateTime?this.navCtrl.navigateForward("SelectDateTimePage",{queryParams:{ROAEO:o.a.ROAEO,condition:n,edit:!0},state:{data:{ROAEO:o.a.ROAEO,condition:n,edit:!0}}}).then(e=>{if(e&&e.data){const r=e.data;(n=r.roomOccupancyActionCondition).description=this.descriptionGen.GetConditionDescription(r.roomOccupancyActionCondition)}}):n.conditionType==y.oS.GlobalVariableValue?this.navCtrl.navigateForward("SelectGlobalVariablePage",{queryParams:{condition:n,ROAEO:o.a.ROAEO,edit:!0},state:{data:{condition:n,ROAEO:o.a.ROAEO,edit:!0}}}).then(e=>{if(e&&e.data){const r=e.data;(n=r.roomOccupancyActionCondition).description=this.descriptionGen.GetConditionDescription(r.roomOccupancyActionCondition)}}):n.conditionType==y.oS.ThingChanged?this.navCtrl.navigateForward("SelectPropertyValuePage",{queryParams:{condition:n,ROAEO:o.a.ROAEO,edit:!0},state:{data:{condition:n,ROAEO:o.a.ROAEO,edit:!0}}}).then(e=>{if(e&&e.data){const r=e.data;(n=r.roomOccupancyActionCondition).description=this.descriptionGen.GetConditionDescription(r.roomOccupancyActionCondition)}}):n.conditionType==y.oS.File&&this.navCtrl.navigateForward("SelectFilePage",{queryParams:{condition:n,ROAEO:o.a.ROAEO,edit:!0},state:{data:{condition:n,ROAEO:o.a.ROAEO,edit:!0}}}).then(e=>{if(e&&e.data){const r=e.data;(n=r.roomOccupancyActionCondition).description=this.descriptionGen.GetConditionDescription(r.roomOccupancyActionCondition)}})}}return(c=s).\u0275fac=function(n){return new(n||c)(t.Y36(O.SH),t.Y36(O.Br),t.Y36(t.R0b),t.Y36(f.sK))},c.\u0275cmp=t.Xpm({type:c,selectors:[["occupancy-room-action"]],inputs:{ROAEO:"ROAEO",action:"action",roomAction:"roomAction"},outputs:{EditedChange:"EditedChange",actionChange:"actionChange",roomActionChange:"roomActionChange"},decls:17,vars:5,consts:[[1,"action-design"],[1,"flex-box"],["class","flex-data",3,"innerHtml",4,"ngIf"],[1,"flex-end"],["ion-button","","clear","",3,"click"],["name","create"],["name","close"],["class","flex-box condition-design",4,"ngFor","ngForOf"],[1,"flex-box","condition-design"],[1,"flex-data"],["ion-button","","clear","","end","",3,"click"],["name","add"],[1,"flex-data",3,"innerHtml"],[3,"innerHtml",4,"ngIf"],[3,"innerHtml"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,J,2,3,"div",2),t.TgZ(3,"div",3)(4,"button",4),t.NdJ("click",function(){return i.editAction()}),t._UZ(5,"ion-icon",5),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return i.removeAction()}),t._UZ(7,"ion-icon",6),t.qZA()()(),t.YNc(8,D,8,1,"div",7),t.TgZ(9,"div",8)(10,"div",9)(11,"ion-label"),t._uU(12),t.ALo(13,"translate"),t.qZA()(),t.TgZ(14,"div",3)(15,"button",10),t.NdJ("click",function(){return i.addCondition()}),t._UZ(16,"ion-icon",11),t.qZA()()()()),2&n&&(t.xp6(2),t.Q6J("ngIf",null==i.action||null==i.action.action?null:i.action.action.description),t.xp6(6),t.Q6J("ngForOf",i.action.conditions),t.xp6(4),t.Oqu(t.lcZ(13,3,"only-if")))},dependencies:[u.sg,u.O5,l.gu,l.Q$,w.t,f.X$,U.Z]}),s})();function F(c,s){if(1&c){const a=t.EpF();t.TgZ(0,"div")(1,"occupancy-room-action",18),t.NdJ("EditedChange",function(i){t.CHM(a);const e=t.oxw(2);return t.KtG(e.OnEdited(i))}),t.qZA()()}if(2&c){const a=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("action",a)("roomAction",n.appState.roomOccupancyAction)}}function N(c,s){1&c&&(t.TgZ(0,"div")(1,"ion-item")(2,"h2"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-button",19),t._uU(6," \xa0"),t._UZ(7,"ion-icon",20),t.qZA()()()),2&c&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"do-action")))}function Y(c,s){1&c&&(t.TgZ(0,"div",21)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._uU(4," \xa0"),t._UZ(5,"ion-icon",20),t.qZA()),2&c&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"then-do")))}function k(c,s){if(1&c){const a=t.EpF();t.TgZ(0,"div"),t.YNc(1,F,2,2,"div",14),t.TgZ(2,"div",15),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.addOccupiedAction())}),t.YNc(3,N,8,3,"div",16),t.YNc(4,Y,6,3,"div",17),t.qZA()()}if(2&c){const a=t.oxw();t.xp6(1),t.Q6J("ngForOf",a.getRoomOccupiedAction),t.xp6(2),t.Q6J("ngIf",(null==a.getRoomOccupiedAction?null:a.getRoomOccupiedAction.length)<1),t.xp6(1),t.Q6J("ngIf",(null==a.getRoomOccupiedAction?null:a.getRoomOccupiedAction.length)>0)}}function G(c,s){if(1&c){const a=t.EpF();t.TgZ(0,"div")(1,"occupancy-room-action",22),t.NdJ("EditedChange",function(i){t.CHM(a);const e=t.oxw(2);return t.KtG(e.OnEdited(i))}),t.qZA()()}if(2&c){const a=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("action",a)("ROAEO",n.appState.ROAEO)("roomAction",n.appState.roomOccupancyAction)}}function q(c,s){1&c&&(t.TgZ(0,"div")(1,"ion-item")(2,"h2"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-button",19),t._uU(6," \xa0"),t._UZ(7,"ion-icon",20),t.qZA()()()),2&c&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"do-action")))}function I(c,s){1&c&&(t.TgZ(0,"div",21)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._uU(4," \xa0"),t._UZ(5,"ion-icon",20),t.qZA()),2&c&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"then-do")))}function Q(c,s){if(1&c){const a=t.EpF();t.TgZ(0,"div"),t.YNc(1,G,2,3,"div",14),t.TgZ(2,"div",15),t.NdJ("click",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.addUnoccupiedAction())}),t.YNc(3,q,8,3,"div",16),t.YNc(4,I,6,3,"div",17),t.qZA()()}if(2&c){const a=t.oxw();t.xp6(1),t.Q6J("ngForOf",a.getRoomUnoccupiedAction),t.xp6(2),t.Q6J("ngIf",(null==a.getRoomUnoccupiedAction?null:a.getRoomUnoccupiedAction.length)<1),t.xp6(1),t.Q6J("ngIf",(null==a.getRoomUnoccupiedAction?null:a.getRoomUnoccupiedAction.length)>0)}}const H=[{path:"",component:(()=>{var c;class s{get getRoomOccupiedAction(){return o.a.roomOccupancyAction?o.a.roomOccupancyAction.actions.filter(n=>n.action.onOccupied==p.Wq.Occupied):[]}get getRoomUnoccupiedAction(){return o.a.roomOccupancyAction?o.a.roomOccupancyAction.actions.filter(n=>n.action.onOccupied==p.Wq.UnOccupied):[]}constructor(n,i,e,r,g,_,C,j,$){if(this.navCtrl=n,this.NavProv=i,this.toastCtrl=e,this.translate=r,this.modalCtrl=g,this.alertCtrl=_,this.router=C,this.platform=j,this.changeDetectorRef=$,this.appState=o.a,this.page="unoccupied",this.SceneConditionType=y.oS,this.OccupancyStatus=p.Wq,this.Edited="no",this.theAppState=o.a,this.router.getCurrentNavigation().extras.state){const V=this.router.getCurrentNavigation().extras.state;this.navParams=V.data,console.log(this.navParams)}this.room=this.navParams.room,this.things_action=o.a.DefaultController.devices,this.things_action.concat(o.a.DefaultController.scenes),this.things_action.concat(o.a.DefaultController.rooms),this.things_properties=o.a.DefaultController.devices,this.things_properties.concat(o.a.DefaultController.rooms)}ionViewDidLeave(){}write(n,i,e){let r=e.split(":");if(3==r.length){let g=parseInt(r[0]),_=parseInt(r[1]),C=parseInt(r[2]);n[i]=C+60*_+3600*g}}ionViewDidEnter(){console.log("ionViewDidEnter RoomOccupancyActionPage"),this.updateDTO()}updateDTO(){var n=this;return(0,m.Z)(function*(){try{o.a.roomOccupancyAction||o.a.DefaultController.GetOccupancyRoomActionsDTO(n.room.id).then(function(){var i=(0,m.Z)(function*(e){o.a.roomOccupancyAction=Object.assign(new p.Kr,e)});return function(e){return i.apply(this,arguments)}}()),n.changeDetectorRef.detectChanges()}catch(i){console.error(i)}})()}deleteAction(n){this.Edited="yes";let i=o.a.roomOccupancyAction.actions.indexOf(n);i>-1&&o.a.roomOccupancyAction.actions.splice(i,1)}addOccupiedAction(){if(this.Edited="yes",(new h.r).roomOccupancyAction=o.a.roomOccupancyAction,o.a.roomOccupancyAction){const i=new h.r;i.roomOccupancyAction=o.a.roomOccupancyAction,o.a.roomOccupancyAction&&(o.a.odata={ROAEO:i},o.a.oonOccupied=p.Wq.Occupied,this.navCtrl.navigateForward("ActionOrPropertyPage"))}}addUnoccupiedAction(){var n=this;return(0,m.Z)(function*(){n.Edited="yes";const i=new h.r;i.roomOccupancyAction=o.a.roomOccupancyAction,o.a.roomOccupancyAction&&(o.a.odata={ROAEO:i},o.a.oonOccupied=p.Wq.UnOccupied,n.navCtrl.navigateForward("ActionOrPropertyPage"))})()}save(){var n=this;x.B.showLoading2().then(()=>{o.a.DefaultController.SetOccupancyRoomActionsDTO(this.room.id,o.a.roomOccupancyAction).then((0,m.Z)(function*(){n.Edited="no",(yield n.toastCtrl.create({message:n.translate.instant("saved"),duration:2e3})).present(),x.B.dismissLoading2(),n.navCtrl.pop()})).catch(i=>{x.B.dismissLoading2()})})}goBack(n=!1){this.cancel()}cancel(){var n=this;return(0,m.Z)(function*(){"yes"==n.Edited?(yield n.alertCtrl.create({cssClass:"network-alert",header:n.translate.instant("are-you-sure-you-want-to-cancel-changes"),buttons:[{text:n.translate.instant("ok"),handler:()=>{n.navCtrl.pop()}},{text:n.translate.instant("cancel"),role:"cancel"}]})).present():n.navCtrl.back()})()}OnEdited(n){this.Edited="yes"}}return(c=s).\u0275fac=function(n){return new(n||c)(t.Y36(O.SH),t.Y36(Z.Y),t.Y36(O.yF),t.Y36(f.sK),t.Y36(O.IN),t.Y36(O.Br),t.Y36(A.F0),t.Y36(O.t4),t.Y36(t.sBO))},c.\u0275cmp=t.Xpm({type:c,selectors:[["room-occupancy-action"]],decls:33,vars:18,consts:[["hideBackButton","true",2,"text-align","center","direction","ltr",3,"ngStyle"],[2,"padding","5px"],[2,"text-align","end","float","right","min-width","10px"],[2,"width","40px","float","left","display","block"],["tappable","","component-click","","tabindex","0",1,"top-mic-button",2,"font-size","30px","text-align","center","vertical-align","middle",3,"click"],["name","chevron-back"],["padding",""],[3,"ngModel","ngModelChange"],["value","unoccupied"],["value","occupied"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"full-primary-button",2,"width","100%",3,"click"],[2,"width","100%","color","#008aff",3,"click"],[4,"ngFor","ngForOf"],[2,"padding","5px",3,"click"],[4,"ngIf"],["style","text-align:center;","class","bottom-tag-full purple",4,"ngIf"],[3,"action","roomAction","EditedChange"],["slot","end",1,"full-primary-button",2,"min-width","4rem","min-height","3rem"],["name","add"],[1,"bottom-tag-full","purple",2,"text-align","center"],[3,"action","ROAEO","roomAction","EditedChange"]],template:function(n,i){1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"div",1),t._UZ(3,"div",2),t.TgZ(4,"div",3)(5,"a",4),t.NdJ("click",function(){return i.goBack()}),t._UZ(6,"ion-icon",5),t.qZA()(),t.TgZ(7,"div")(8,"ion-title"),t._uU(9),t.qZA()()()()(),t.TgZ(10,"ion-content",6)(11,"div",6)(12,"ion-segment",7),t.NdJ("ngModelChange",function(r){return i.page=r}),t.TgZ(13,"ion-segment-button",8),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"ion-segment-button",9),t._uU(17),t.ALo(18,"translate"),t.qZA()()(),t.TgZ(19,"div",10),t.YNc(20,k,5,3,"div",11),t.YNc(21,Q,5,3,"div",11),t.qZA(),t.TgZ(22,"div")(23,"ion-grid")(24,"ion-row")(25,"ion-col")(26,"ion-button",12),t.NdJ("click",function(){return i.save()}),t._uU(27),t.ALo(28,"translate"),t.qZA()(),t.TgZ(29,"ion-col")(30,"ion-button",13),t.NdJ("click",function(){return i.cancel()}),t._uU(31),t.ALo(32,"translate"),t.qZA()()()()()()),2&n&&(t.xp6(1),t.Q6J("ngStyle",i.theAppState.iontoolbarStyle),t.xp6(8),t.Oqu(null==i.room?null:i.room.translated_name),t.xp6(3),t.Q6J("ngModel",i.page),t.xp6(2),t.hij(" ",t.lcZ(15,10,"on-unoccupied")," "),t.xp6(3),t.hij(" ",t.lcZ(18,12,"on-occupied")," "),t.xp6(2),t.Q6J("ngSwitch",i.page),t.xp6(1),t.Q6J("ngSwitchCase","occupied"),t.xp6(1),t.Q6J("ngSwitchCase","unoccupied"),t.xp6(6),t.Oqu(t.lcZ(28,14,"save")),t.xp6(4),t.Oqu(t.lcZ(32,16,"cancel")))},dependencies:[u.sg,u.O5,u.PC,u.RF,u.n9,v.JJ,v.On,l.YG,l.wI,l.W2,l.jY,l.Gu,l.gu,l.Ie,l.Nd,l.cJ,l.GO,l.wd,l.sr,l.QI,P.T,T.c,S,f.X$],styles:["ion-input[_ngcontent-%COMP%]{color:#333;background:#eee;border-radius:5px;font-weight:700}ion-item.arm-card[_ngcontent-%COMP%]{margin-bottom:10px;box-shadow:.2vw .2vw 1vw #000000ba;background-color:#0003;border-radius:3vw}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{padding:10px}ion-item[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;overflow:hidden;min-width:40px;min-height:40px}ion-button.alert-button[_ngcontent-%COMP%]{height:3.6rem;font-size:1.4rem;font-weight:500;text-transform:uppercase;color:#fff}ion-segment-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2.6rem;line-height:4rem}.segment-button-checked[_ngcontent-%COMP%]{border-color:#aaa;opacity:1;border-bottom-width:2px;border-bottom-style:solid;border-bottom-color:#f5f5f5}.segment-button-disabled[_ngcontent-%COMP%]{opacity:.3;pointer-events:none}ion-segment-button[_ngcontent-%COMP%]{--color: gray;--color-checked: white;--background:linear-gradient(to bottom, rgba(53,90,117,1) 0%,rgba(8,54,86,1) 100%);--background-focused-opacity: 1;--borderborder-bottom-width: 2px;--border-top-style: solid}ion-item[_ngcontent-%COMP%]{--background: rgba(33,33,33,.3);--border-radius: 6px;font-size:1.4rem}"]}),s})()}];let L=(()=>{var c;class s{}return(c=s).\u0275fac=function(n){return new(n||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[A.Bz.forChild(H),A.Bz]}),s})();var B=d(23934),z=d(79773);let K=(()=>{var c;class s{}return(c=s).\u0275fac=function(n){return new(n||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[u.ez,v.u5,l.Pc,L,B.o,f.aw.forChild(),z.D]}),s})()},48753:(E,R,d)=>{d.d(R,{c:()=>v});var u=d(65879);let v=(()=>{var l;class A{constructor(p){this.elementRef=p}ngOnInit(){this.elementRef.nativeElement.classList.add("ion-padding")}}return(l=A).\u0275fac=function(p){return new(p||l)(u.Y36(u.SBq))},l.\u0275dir=u.lG2({type:l,selectors:[["","padding",""]]}),A})()}}]);