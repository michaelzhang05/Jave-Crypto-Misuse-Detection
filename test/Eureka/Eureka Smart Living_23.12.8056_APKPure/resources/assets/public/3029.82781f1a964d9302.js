"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3029],{3029:(J,b,r)=>{r.r(b),r.d(b,{ESpeechRecognitionPageModule:()=>D});var f=r(96814),A=r(56223),g=r(73582),w=r(70160),h=r(15861),v=r(37092),c=r(46729),M=r(56544),P=r(57288),l=r(8873),_=r(31138),T=r(60566),n=r(65879),p=r(34414),C=r(63999),O=r(77935);const Z=["listeningBtn"];function R(i,d){if(1&i){const a=n.EpF();n.TgZ(0,"a",21),n.NdJ("touchstart",function(e){n.CHM(a);const o=n.oxw();return n.KtG(o.longPressStart(e))})("touchend",function(){n.CHM(a);const e=n.oxw();return n.KtG(e.PressEnd())}),n._UZ(1,"ion-icon",22),n.TgZ(2,"ion-badge",23),n._uU(3),n.qZA()()}if(2&i){const a=n.oxw();n.xp6(3),n.Oqu(a.speech_language_symbol)}}function E(i,d){if(1&i&&(n.TgZ(0,"ion-item")(1,"table")(2,"tr")(3,"td"),n._UZ(4,"ion-icon",24),n.qZA(),n.TgZ(5,"td")(6,"p"),n._uU(7),n.qZA()(),n.TgZ(8,"td"),n._UZ(9,"ion-icon",24),n.qZA()()()()),2&i){const a=d.$implicit,t=n.oxw();n.xp6(1),n.Tol(a.sender),n.Udp("float","user"==a.sender?"right":"left")("direction",t.dir),n.xp6(3),n.Udp("display","user"==a.sender?"none":"block"),n.s9C("name",a.icon),n.xp6(3),n.hij(" ",a.message," "),n.xp6(2),n.Udp("display","user"!=a.sender?"none":"block"),n.s9C("name",a.icon)}}function k(i,d){if(1&i){const a=n.EpF();n.TgZ(0,"ion-col",15)(1,"div")(2,"button",25,17),n.NdJ("click",function(){n.CHM(a);const e=n.oxw();return n.KtG(e.startAlways())}),n._UZ(4,"ion-icon",18),n.qZA()()()}if(2&i){const a=n.oxw();n.xp6(2),n.Tol(a.isListening?"auto-primary-button listening":"auto-primary-button normal")}}function B(i,d){if(1&i){const a=n.EpF();n.TgZ(0,"ion-col",15)(1,"div")(2,"button",26,27),n.NdJ("click",function(){n.CHM(a);const e=n.oxw();return n.KtG(e.stopAlwaysListen())}),n._UZ(4,"ion-icon",18),n.qZA()()()}if(2&i){const a=n.oxw();n.xp6(2),n.Tol(a.isAlwaysListening?"auto-primary-button listening":"auto-primary-button normal")}}const Y=[{path:"",component:(()=>{var i;class d extends M.n{constructor(t,e,o,s,u,m,y,U,x,L,V,S,z,F){super(e,S,o,s,t,V,!1,x,y,u,L),this.navCtrl=t,this.api=e,this.alertCtrl=o,this.translation=s,this.settings=u,this.modalCtrl=m,this.toastCtrl=y,this.loadingCtrl=U,this.router=x,this.popoverCtrl=L,this.zone=V,this.platform=S,this.navParams=z,this.speech=F,this.responses=[],this.default_language="en",this.default_language_icon="EN",this.isListening=!1,this.isAlwaysListening=!1,this.runAlwaysListen=!0,this.runOffAlwaysListen=!1,this.onceSound=0,this.dir="ltr",this.theAppState=l.a,this.customCMD="",this.speech=new P.d(_.B.EVoiceRecogProvider,this.toastController,this.zone),this.voiceCommandControl=l.a.DefaultController.voiceCommandControl,this.isExperimental=l.a.Experimental,this.platform.ready().then(G=>{this.default_language_icon=c.V0.defaultVoiceLanguage.displaySymbol}),this.dir="ltr"}get AppIcon(){return v.Y.getAppLogo}stopAlwaysListen(){this.runAlwaysListen=!1,this.runOffAlwaysListen=!1,this.showToast("Stop Always Listening Mode")}startAlways(){this.runAlwaysListen=!0,this.startAlwaysListen()}getDefaultVolumes(){this.platform.is("android")&&(window.androidVolume.getMusic(function(t){l.a.musicVolume=t}),window.androidVolume.getAlarm(function(t){l.a.alarmVolume=t}),window.androidVolume.getDTMF(function(t){l.a.dTMFVolume=t}),window.androidVolume.getNotification(function(t){l.a.notificationVolume=t}),window.androidVolume.getRinger(function(t){l.a.ringerVolume=t}),window.androidVolume.getSystem(function(t){l.a.systemVolume=t}),window.androidVolume.getVoiceCall(function(t){l.a.voiceCallVolume=t}))}startAlwaysListen(){if(this.runAlwaysListen){this.platform.is("android")&&window.androidVolume.setAll(0),console.log("Always Listening"),this.runOffAlwaysListen=!0,0==this.onceSound&&this.showToast("Always Listening Mode");let t=this;console.warn("start Listen");let e={language:c.V0.defaultVoiceLanguage.speechToTextCode,matches:5,prompt:"Say your command! (e.g. show me Lights)",showPopup:!1,showPartial:!1};0==this.onceSound&&t.zone.run(()=>{this.isAlwaysListening=!0}),this.onceSound++,this.speech.listen().startListening(e).subscribe(o=>{this.speech.stopListening(),t.zone.run(()=>{t.matches=o,o.length>0&&("en-US"==c.V0.defaultVoiceLanguage.code?this.voiceCommandControl.execute(o,c.V0.defaultVoiceLanguage.code,void 0,"Eureka").then(s=>{this.AddCommunication(s)}):"ar"==c.V0.defaultVoiceLanguage.code?this.voiceCommandControl.execute(o,c.V0.defaultVoiceLanguage.code,void 0,"\u064a\u0648\u0631\u064a\u0643\u0627").then(s=>{this.AddCommunication(s)}):this.voiceCommandControl.execute(o,c.V0.defaultVoiceLanguage.code).then(s=>{this.AddCommunication(s)})),this.isAlwaysListening=!0,this.startAlwaysListen()})},o=>{t.zone.run(()=>{console.warn("stopped listing, got error,",o),this.isAlwaysListening=!0,this.startAlwaysListen()})},()=>{t.zone.run(()=>{this.isAlwaysListening=!0,this.startAlwaysListen(),console.debug("listening is stopped")})})}else this.platform.is("android")&&(window.androidVolume.setAlarm(l.a.alarmVolume),window.androidVolume.setDTMF(l.a.dTMFVolume),window.androidVolume.setMusic(l.a.musicVolume),window.androidVolume.setNotification(l.a.notificationVolume),window.androidVolume.setRinger(l.a.ringerVolume),window.androidVolume.setSystem(l.a.systemVolume),window.androidVolume.setVoiceCall(l.a.voiceCallVolume))}startListen(){var t=this;return(0,h.Z)(function*(){let e=t;console.warn("start Listen");let o={language:c.V0.defaultVoiceLanguage.speechToTextCode,matches:5,prompt:"Say your command! (e.g. show me Lights.)",showPopup:!1,showPartial:!1};e.zone.run(()=>{_.B.SoundPlayer.playStartRecognitionSound(),t.isListening=!0,t.platform.is("ios")&&window.setTimeout(()=>{t.speech.stopListening()},4e3)}),t.speech.listen().startListening(o).subscribe(s=>{t.speech.stopListening(),e.zone.run(()=>{_.B.SoundPlayer.playStopRecognitionSound(),t.isListening=!1,e.matches=s,s.length>0&&t.voiceCommandControl.execute(s,c.V0.defaultVoiceLanguage.code).then(u=>{t.AddCommunication(u)})})},s=>{e.zone.run(()=>{console.warn("stopped listing, got error,",s),t.isListening=!1}),_.B.SoundPlayer.playStopRecognitionSound()},()=>{e.zone.run(()=>{t.isListening=!1,console.debug("listening is stopped")})})})()}getThingNameAndAction(t){if(1==t.thing_type){let e="";if(null!=t.user_parameters){for(let s=0;s<t.user_parameters.length;s++)e+=t.user_parameters[s]+",";e=e.substr(0,e.length-1)}let o=l.a.DefaultController.devices.find(s=>s.id==t.thing_id);return(t.action?this.translation.instant(t.action)+": ":"")+(t.user_parameters.length>0?" ("+t.user_parameters.join(" ")+") ":"")+o.translated_name}if(2==t.thing_type){let e=l.a.DefaultController.scenes.find(o=>o.id==t.thing_id);return(t.action?this.translation.instant(t.action)+": ":"")+e.translated_name}if(3==t.thing_type){let e=l.a.DefaultController.rooms.find(o=>o.id==t.room_id);return(t.action?this.translation.instant(t.action)+": ":"")+e.translated_name}return this.translation.instant(t.error)}stopListen(){this.speech.stopListening()}ionViewDidLoad(){console.log("ionViewDidLoad ESpeechRecognitionPage"),this.scrollToBottom()}sendCMD(){this.voiceCommandControl.execute([this.customCMD],c.V0.defaultVoiceLanguage.code).then(t=>{console.log(t),this.AddCommunication(t)}).catch(t=>{console.log(t)})}AddCommunication(t){console.log(t),this.responses.push({sender:"user",icon:"person",message:t.voice_command}),this.responses.push({sender:"eureka",icon:"home",message:(t.error?this.translation.instant("failed")+": ":this.translation.instant("ok")+"! ")+this.getThingNameAndAction(t)+(t.multiple_thing_found?" - "+t.multiple_thing_names.join(", "):"")})}loadingDisplay(){var t=this;return(0,h.Z)(function*(){let e=t.loadingCtrl.create({spinner:"dots"});(yield e).onDidDismiss().then(()=>{console.log("Dismissed loading")}),(yield e).present()})()}showListeningStatus(){console.log("Displaying Listening Status: "+this.speech.isListening)}showToast(t){var e=this;return(0,h.Z)(function*(){(yield e.toastCtrl.create({position:"middle",message:t,duration:2e3})).present()})()}ngOnInit(){this.scrollToBottom()}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){null!=this.myScrollContainer&&this.myScrollContainer.scrollToBottom()}changeSpeechLanguage(t){var e=this;return(0,h.Z)(function*(){let o=[],s=[];for(let u=0;u<c.V0.voiceLanguages.length;u++){let m=c.V0.voiceLanguages[u];o.push({type:"radio",label:m.displayName,value:m.code,checked:m.code==c.V0.defaultVoiceLanguage.code})}s.push(e.translate.instant("cancel")),s.push({text:e.translate.instant("ok"),handler:u=>{let m=c.V0.voiceLanguages.find(y=>y.code==u);null!=m&&(c.V0.defaultVoiceLanguage=m,e.settings.setValue("speech_lang",c.V0.defaultVoiceLanguage.code),e.default_language_icon=c.V0.defaultVoiceLanguage.displaySymbol)}}),(yield e.alertCtrl.create({cssClass:"network-alert",header:e.translate.instant("select-language"),inputs:o,buttons:s,message:e.translate.instant("select-language-for-voice-recognition")})).present()})()}showHelp(){var t=this;return(0,h.Z)(function*(){(yield t.popoverCtrl.create({component:T.r,componentProps:["voice"],cssClass:"fullscreen-modal",showBackdrop:!0})).present()})()}}return(i=d).\u0275fac=function(t){return new(t||i)(n.Y36(p.SH),n.Y36(c.V0),n.Y36(p.Br),n.Y36(C.sK),n.Y36(O.Z),n.Y36(p.IN),n.Y36(p.yF),n.Y36(p.HT),n.Y36(w.F0),n.Y36(p.Dh),n.Y36(n.R0b),n.Y36(p.t4),n.Y36(p.X1),n.Y36(P.d))},i.\u0275cmp=n.Xpm({type:i,selectors:[["e-speech-recognition"]],viewQuery:function(t,e){if(1&t&&(n.Gf(g.W2,5),n.Gf(Z,5)),2&t){let o;n.iGM(o=n.CRH())&&(e.myScrollContainer=o.first),n.iGM(o=n.CRH())&&(e.listeningBtn=o.first)}},features:[n.qOj],decls:35,vars:11,consts:[["hideBackButton","true",2,"text-align","center","direction","ltr",3,"ngStyle"],[2,"padding","5px"],[2,"text-align","end","float","right","min-width","10px"],["class","top-mic-button","style","vertical-align:bottom;",3,"touchstart","touchend",4,"ngIf"],[2,"width","40px","float","left","display","block"],["tappable","","component-click","","tabindex","0",1,"top-mic-button",2,"font-size","30px","text-align","center","vertical-align","middle",3,"click"],["name","chevron-back"],[2,"--background","var(--ion-item-background) !important"],[1,"chat-box",2,"min-height","80%"],[4,"ngFor","ngForOf"],[2,"background","black !important"],[1,"ion-justify-content-center"],[1,"ion-align-self-start",2,"text-align","left"],["ion-button","",1,"auto-primary-button",3,"click"],["name","information-circle"],[1,"ion-align-self-center"],["ion-button","","primary","","id","listeningBtn","name","listeningBtn",2,"position","unset","border-radius","100%",3,"click"],["listeningBtn",""],["name","mic"],["class","ion-align-self-center",4,"ngIf"],[1,"ion-align-self-end",2,"text-align","right"],[1,"top-mic-button",2,"vertical-align","bottom",3,"touchstart","touchend"],["name","mic",1,"voice-mic-button"],[1,"top-badge"],[3,"name"],["ion-button","","primary","","id","listeningBtn","name","listeningBtn",2,"position","unset","border-radius","100%","background","brown",3,"click"],["ion-button","","primary","","id","listeningBtn1","name","listeningBtn1",2,"position","unset","border-radius","100%","background","brown",3,"click"],["listeningBtn1",""]],template:function(t,e){1&t&&(n.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"div")(3,"div",1)(4,"div",2),n.YNc(5,R,4,1,"a",3),n.qZA(),n.TgZ(6,"div",4)(7,"a",5),n.NdJ("click",function(){return e.goBack()}),n._UZ(8,"ion-icon",6),n.qZA()(),n.TgZ(9,"div")(10,"ion-title"),n._uU(11),n.ALo(12,"translate"),n.qZA()()()()()(),n.TgZ(13,"ion-content",7)(14,"ion-list",8),n.YNc(15,E,10,13,"ion-item",9),n.qZA()(),n.TgZ(16,"ion-footer",10)(17,"ion-toolbar")(18,"ion-grid")(19,"ion-row",11)(20,"ion-col",12)(21,"div")(22,"button",13),n.NdJ("click",function(){return e.showHelp()}),n._UZ(23,"ion-icon",14),n.qZA()()(),n.TgZ(24,"ion-col",15)(25,"div")(26,"button",16,17),n.NdJ("click",function(){return e.startListen()}),n._UZ(28,"ion-icon",18),n.qZA()()(),n.YNc(29,k,5,2,"ion-col",19),n.YNc(30,B,5,2,"ion-col",19),n.TgZ(31,"ion-col",20)(32,"div")(33,"button",13),n.NdJ("click",function(){return e.changeSpeechLanguage(null)}),n._uU(34),n.qZA()()()()()()()),2&t&&(n.xp6(1),n.Q6J("ngStyle",e.theAppState.iontoolbarStyle),n.xp6(4),n.Q6J("ngIf",e.platform.is("ios")||e.platform.is("android")),n.xp6(6),n.Oqu(n.lcZ(12,9,"voice_cmd")),n.xp6(4),n.Q6J("ngForOf",e.responses),n.xp6(11),n.Tol(e.isListening?"auto-primary-button listening":"auto-primary-button normal"),n.xp6(3),n.Q6J("ngIf",!e.runOffAlwaysListen&&e.isExperimental),n.xp6(1),n.Q6J("ngIf",e.runOffAlwaysListen),n.xp6(4),n.Oqu(e.default_language_icon))},dependencies:[f.sg,f.O5,f.PC,g.yp,g.wI,g.W2,g.fr,g.jY,g.Gu,g.gu,g.Ie,g.q_,g.Nd,g.wd,g.sr,C.X$],styles:["ion-scroll[_ngcontent-%COMP%]{height:90%}.scroll-content[_ngcontent-%COMP%]{padding:0!important;margin:0}.chat-box[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{margin:3px;background-color:transparent;box-shadow:none;border-radius:5px}.chat-box[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{max-width:90%;padding:7px;border-radius:20px;display:table-cell}.chat-box[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:3px;white-space:normal}.chat-box[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px}.chat-box[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] + td[_ngcontent-%COMP%] + td[_ngcontent-%COMP%]{color:orange;padding:4px}ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{direction:ltr;padding:15px;box-shadow:0 0 10px #333}ion-footer[_ngcontent-%COMP%]   .toolbar-background[_ngcontent-%COMP%]{background:none;background-color:#000}ion-footer[_ngcontent-%COMP%]   .toolbar-content[_ngcontent-%COMP%]   toolbar-content-md[_ngcontent-%COMP%]{align-items:center;justify-content:center}ion-footer[_ngcontent-%COMP%]   .toolbar-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:25px;min-height:60px;min-width:60px;margin:auto}.col[_ngcontent-%COMP%]{text-align:center}@keyframes _ngcontent-%COMP%_listeningAnim{0%{box-shadow:0 0 10px #fff}to{box-shadow:0 0 20px #fff}}.normal[_ngcontent-%COMP%]{position:relative;animation:none;border:none;animation-play-state:paused}.listening[_ngcontent-%COMP%]{border:3px solid #fff;animation:_ngcontent-%COMP%_listeningAnim .5s ease-in-out infinite alternate-reverse}.auto-primary-button[_ngcontent-%COMP%]{font-size:25px;min-height:60px;min-width:60px;margin:auto}"]}),d})()}];let N=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({imports:[w.Bz.forChild(Y),w.Bz]}),d})(),D=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({imports:[f.ez,A.u5,g.Pc,C.aw,N]}),d})()}}]);