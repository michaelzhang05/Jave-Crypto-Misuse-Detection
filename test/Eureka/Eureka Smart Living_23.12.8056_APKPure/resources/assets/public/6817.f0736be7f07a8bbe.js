"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6817,9764],{6817:(N,O,d)=>{d.r(O),d.d(O,{RoomsPageModule:()=>le});var k=d(96814),C=d(56223),f=d(73582),E=d(70160),w=d(15861),p=d(46729),I=d(51141),b=d(77144),g=d(9952),x=d(37092),Z=d(56544),h=d(8873),M=d(15231),L=d(19462),e=d(65879),y=d(34414),U=d(63999),H=d(77935),Y=d(59764),F=d(69705);function Q(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.toggle_reorder())}),e._UZ(1,"ion-icon",16),e.qZA()}}function B(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.toggle_hand())}),e._UZ(1,"ion-icon",17),e.qZA()}if(2&s){const n=e.oxw();e.xp6(1),e.Q6J("name",n.disable_hand?"hand-right-outline":"thumbs-up")}}function q(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.get_default_order())}),e._UZ(1,"ion-icon",18),e.qZA()}}function V(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.save_reorder())}),e._UZ(1,"ion-icon",19),e.qZA()}}function z(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(n);const o=e.oxw();return e.KtG(o.cancel_reorder())}),e._UZ(1,"ion-icon",20),e.qZA()}}function K(s,m){if(1&s&&(e.TgZ(0,"div",45),e._UZ(1,"img",46),e.qZA()),2&s){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.IMAGES.lock_thing,e.LSH)}}function $(s,m){if(1&s&&(e.TgZ(0,"div",45),e._UZ(1,"img",46),e.qZA()),2&s){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.IMAGES.lock_thing,e.LSH)}}function j(s,m){if(1&s&&(e.TgZ(0,"div",45),e._UZ(1,"img",46),e.qZA()),2&s){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.IMAGES.lock_thing,e.LSH)}}function W(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"ion-grid")(1,"ion-row",41)(2,"ion-col",42)(3,"button",43),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.toggleLights(o))}),e._UZ(4,"img",26),e.qZA(),e.YNc(5,K,2,1,"div",44),e.qZA(),e.TgZ(6,"ion-col",42)(7,"button",43),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.toggleCurtains(o))}),e._UZ(8,"img",26),e.qZA(),e.YNc(9,$,2,1,"div",44),e.qZA(),e.TgZ(10,"ion-col",42)(11,"button",43),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.toggleAC(o))}),e._UZ(12,"img",26),e.qZA(),e.YNc(13,j,2,1,"div",44),e.qZA()()()}if(2&s){const n=e.oxw().$implicit,t=e.oxw();e.xp6(3),e.Tol("button ion-button lock room-item-buttons"+(n.have_lights?"":" inactive")),e.xp6(1),e.Q6J("src",n.is_lights_on?t.IMAGES.light._100:t.IMAGES.light._10,e.LSH),e.xp6(1),e.Q6J("ngIf",n.is_lights_locked),e.xp6(2),e.Tol("button ion-button lock room-item-buttons"+(n.have_curtain?"":" inactive")),e.xp6(1),e.Q6J("src",n.is_curtains_open?t.IMAGES.shutter._100:t.IMAGES.shutter._0,e.LSH),e.xp6(1),e.Q6J("ngIf",n.is_curtains_locked),e.xp6(2),e.Tol("button ion-button lock room-item-buttons"+(n.have_ac?"":" inactive")),e.xp6(1),e.Q6J("src",n.is_ac_on?t.IMAGES.thermostat_state.on:t.IMAGES.thermostat_state.off,e.LSH),e.xp6(1),e.Q6J("ngIf",n.is_ac_locked)}}function X(s,m){if(1&s&&(e.TgZ(0,"div",45),e._UZ(1,"img",46),e.qZA()),2&s){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.IMAGES.lock_thing,e.LSH)}}function ee(s,m){if(1&s&&(e.TgZ(0,"div",45),e._UZ(1,"img",46),e.qZA()),2&s){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.IMAGES.lock_thing,e.LSH)}}function te(s,m){if(1&s&&(e.TgZ(0,"div",45),e._UZ(1,"img",46),e.qZA()),2&s){const n=e.oxw(3);e.xp6(1),e.Q6J("src",n.IMAGES.lock_thing,e.LSH)}}function oe(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"ion-row")(1,"ion-grid")(2,"ion-row")(3,"ion-col",42)(4,"button",43),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.toggleLights(o))}),e._UZ(5,"img",26),e.qZA(),e.YNc(6,X,2,1,"div",44),e.qZA(),e.TgZ(7,"ion-col",42)(8,"button",43),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.toggleCurtains(o))}),e._UZ(9,"img",26),e.qZA(),e.YNc(10,ee,2,1,"div",44),e.qZA(),e.TgZ(11,"ion-col",42)(12,"button",43),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.toggleAC(o))}),e._UZ(13,"img",26),e.qZA(),e.YNc(14,te,2,1,"div",44),e.qZA()()()()}if(2&s){const n=e.oxw().$implicit,t=e.oxw();e.xp6(4),e.Tol("button ion-button lock room-item-buttons"+(n.have_lights?"":" inactive")),e.xp6(1),e.Q6J("src",n.is_lights_on?t.IMAGES.light._100:t.IMAGES.light._0,e.LSH),e.xp6(1),e.Q6J("ngIf",n.is_lights_locked),e.xp6(2),e.Tol("button ion-button lock room-item-buttons"+(n.have_curtain?"":" inactive")),e.xp6(1),e.Q6J("src",n.is_curtains_open?t.IMAGES.shutter._100:t.IMAGES.shutter._0,e.LSH),e.xp6(1),e.Q6J("ngIf",n.is_curtains_locked),e.xp6(2),e.Tol("button ion-button lock room-item-buttons"+(n.have_ac?"":" inactive")),e.xp6(1),e.Q6J("src",n.is_ac_on?t.IMAGES.thermostat_state.on:t.IMAGES.thermostat_state.off,e.LSH),e.xp6(1),e.Q6J("ngIf",n.is_ac_locked)}}function ne(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"div",47)(1,"button",48),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.moveItemUp(o))}),e._UZ(2,"ion-icon",49),e.qZA(),e.TgZ(3,"button",50),e.NdJ("click",function(){e.CHM(n);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.moveItemDown(o))}),e._UZ(4,"ion-icon",51),e.qZA()()}}function ie(s,m){if(1&s){const n=e.EpF();e.TgZ(0,"ion-reorder",21)(1,"ion-card")(2,"ion-grid")(3,"ion-row",22)(4,"ion-col",23)(5,"div",24)(6,"button",25),e.NdJ("click",function(){const i=e.CHM(n).$implicit,r=e.oxw();return e.KtG(r.openRoom(i))}),e._UZ(7,"img",26),e.qZA()()(),e.TgZ(8,"ion-col",27)(9,"ion-grid")(10,"ion-row")(11,"ion-col",28)(12,"h2",29),e.NdJ("touchstart",function(o){const r=e.CHM(n).$implicit,l=e.oxw();return e.KtG(l.longPressStartThing(o,r.id,3))})("mousedown",function(o){const r=e.CHM(n).$implicit,l=e.oxw();return e.KtG(l.longPressMouseStart(o,r.id,3))})("touchmove",function(o){e.CHM(n);const i=e.oxw();return e.KtG(i.touchMoving(o))})("touchend",function(o){e.CHM(n);const i=e.oxw();return e.KtG(i.pressEndThing(o))}),e._uU(13),e.qZA(),e._UZ(14,"div",30),e.qZA()(),e.TgZ(15,"ion-row")(16,"ion-col"),e.YNc(17,W,14,12,"ion-grid",31),e.qZA()()()()(),e.YNc(18,oe,15,12,"ion-row",31),e.TgZ(19,"ion-row")(20,"ion-col"),e._UZ(21,"div",30),e.TgZ(22,"ion-grid",32)(23,"ion-row")(24,"ion-col",33),e.NdJ("click",function(){const i=e.CHM(n).$implicit,r=e.oxw();return e.KtG(r.showOccupancyDialog(i))}),e._uU(25),e._UZ(26,"img",34),e.qZA(),e.TgZ(27,"ion-col",35),e._UZ(28,"img",36),e.qZA(),e.TgZ(29,"ion-col",35),e._UZ(30,"img",36),e.qZA(),e.TgZ(31,"ion-col",35),e._UZ(32,"img",36),e.qZA()(),e.TgZ(33,"ion-row")(34,"ion-col",37)(35,"div",38),e._uU(36),e.qZA()(),e.TgZ(37,"ion-col",39)(38,"div",38),e._uU(39),e.qZA()(),e.TgZ(40,"ion-col",35)(41,"div",38),e._uU(42),e.qZA()(),e.TgZ(43,"ion-col",35)(44,"div",38),e._uU(45),e.qZA()()()()()()(),e.YNc(46,ne,5,0,"div",40),e.qZA()()}if(2&s){const n=m.$implicit,t=e.oxw();e.Q6J("key",n.id),e.xp6(7),e.Q6J("src",null==n?null:n.image_url,e.LSH),e.xp6(6),e.Oqu(n.translated_name),e.xp6(4),e.Q6J("ngIf",t._screen.width>338),e.xp6(1),e.Q6J("ngIf",t._screen.width<=338),e.xp6(6),e.Tol(null!=n.OccupancyState?"":"inactive"),e.xp6(1),e.hij(" ",n.occupied," "),e.xp6(1),e.Udp("background-image",n.ForceOccupancyState?"url("+t.IMAGES.forced_occupancy+")":n.ManualOccupancyState?"url("+t.IMAGES.manual_occupancy+")":""),e.Q6J("src",n.OccupancyState?t.IMAGES.occupied:t.IMAGES.unoccupied,e.LSH),e.xp6(1),e.Tol(n.have_temp?"":"inactive"),e.xp6(1),e.Q6J("src",t.IMAGES.thermometer_icon,e.LSH),e.xp6(1),e.Tol(n.have_door?"":"inactive"),e.xp6(1),e.Q6J("src",n.is_door_open?t.IMAGES.door_open_icon:t.IMAGES.door_close_icon,e.LSH),e.xp6(1),e.Tol(n.have_msensor?"":"inactive"),e.xp6(1),e.Q6J("src",n.is_msensor_active?t.IMAGES.motion.active:t.IMAGES.motion.idle,e.LSH),e.xp6(3),e.Udp("display",null==n.OccupancyState?"none":"block"),e.xp6(1),e.Oqu(n.OccupancyDT),e.xp6(1),e.Tol(n.have_temp?"":"inactive"),e.xp6(2),e.Oqu(n.temp),e.xp6(1),e.Tol(n.have_door?"":"inactive"),e.xp6(2),e.Oqu(n.door_breached_time_string),e.xp6(1),e.Tol(n.have_msensor?"":"inactive"),e.xp6(2),e.Oqu(n.sensor_breached_time_string),e.xp6(1),e.Q6J("ngIf",t.reorderSaveState)}}const re=[{path:"",component:(()=>{var s;class m extends Z.n{constructor(t,o,i,r,l,c,R,A,J,P,S,D,G){if(super(o,l,i,r,t,c,!1,D),this.navCtrl=t,this.platform=l,this.popoverCtrl=R,this.loadingCtrl=P,this.navParams=S,this.router=D,this.changeDetector=G,this.IMAGES=L.s.Images,this.next_type="device",this.filter="",this.addedRooms=[],this.listOfRooms=[],this._temp_update_timer=-1,this.delay_update=!1,this.delay_update_timeout=-1,this.enable_reorder=!1,this.theAppState=h.a,this.toggleLightsForRoom=(u,v)=>{for(let a=0;a<u.children_rooms.length;a++)this.toggleLightsForRoom(u.children_rooms[a],v);console.log("toggle lights for room",u.name),this.delay_update=!0;let T=v;for(let a=0;a<u.devices.length;a++){let _=u.devices[a];_.permission_readonly||_.ExcludeFromRoomControl||_.category==g.I.Lighting&&(_.type==b.Y.Switch||_.type==b.Y.Dimmer||_.type==b.Y.RGB)&&_.turnState(T)}},this.toggleCurtainsForRoom=(u,v)=>{for(let a=0;a<u.children_rooms.length;a++)this.toggleCurtainsForRoom(u.children_rooms[a],v);this.delay_update=!0;let T=v;for(let a=0;a<u.devices.length;a++){let _=u.devices[a];_.permission_readonly||_.category==g.I.Curtains&&_.type==b.Y.Shutter&&(T?_.turnOn():_.turnOff())}},this.toggleACForRoom=(u,v)=>{console.log("Toggle AC for room",u.name);for(let a=0;a<u.children_rooms.length;a++)this.toggleACForRoom(u.children_rooms[a],v);this.delay_update=!0;let T=v;for(let a=0;a<u.devices.length;a++){let _=u.devices[a];_.permission_readonly||_.category==g.I.HVAC&&_.type==b.Y.Thermostat&&(1==T?_.turnOn():0==T&&_.turnOff())}},this.longPressCounter=0,this.longPressDetected=!1,this.yScrollDt=0,this.reorderRoomsIds=[],this.reorderSaveState=!1,this.disable_hand=!0,this._screen=screen,D.getCurrentNavigation().extras.state){const u=this.router.getCurrentNavigation().extras.state;if(console.log(u," params"),null!=u.data){let v=this.navParams.get("filter");null==v||null==v?this.next_type=u.data:this.filter=v}}this.InitializeAllRooms()}InitializeAllRooms(){if(console.time("initializeAllRooms"),this.addedRooms=[],null!=h.a.DefaultController&&null!=h.a.DefaultController.rooms){if(this.addedRooms=h.a.DefaultController.rooms.filter(t=>t.visible).sort((t,o)=>{let i=this.compare(t.sort_order,o.sort_order);return 0==i&&(i=this.compare(t.translated_name,o.translated_name)),i}),this.addedRooms&&this.addedRooms.length)for(let t=0;t<this.addedRooms.length;t++)this.addedRooms[t].updateTranslatedName();this.listOfRooms=this.addedRooms}else this.navCtrl.navigateRoot(I.g6,{animationDirection:"forward"});console.timeEnd("initializeAllRooms")}get AppIcon(){return x.Y.getAppLogo}ionViewDidLeave(){this._delay4sUpdate&&(p.V0.events.unsubscribe(M.B.DeviceUpdate,this._delay4sUpdate),this._delay4sUpdate=void 0),clearInterval(this._temp_update_timer),clearTimeout(this.delay_update_timeout)}updateTimer(){for(let t=0;t<this.addedRooms.length;t++){let o=this.addedRooms[t];o.have_door&&(o.door_breached_time_string=p.V0.getElapsedDateTime(new Date(o.door_breached_time),this.translate.currentLang,!1)),o.have_msensor&&(o.sensor_breached_time_string=p.V0.getElapsedDateTime(new Date(o.sensor_breached_time),this.translate.currentLang,!1));let i=1==o.OccupancyState?o.OccupiedSince:o.UnoccupiedSince;i&&(o.OccupancyDT=p.V0.getElapsedDateTime(new Date(i),this.translate.currentLang,!1))}}updateRoomInfo(t){this._updateRoomInfo(t)}_updateRoomInfo(t){t.is_ac_locked=!1,t.have_temp=!1,t.have_door=!1,t.is_door_open=!1,t.have_msensor=!1,t.have_humidity=!1,t.is_lights_locked=!1,t.is_curtains_locked=!1,t.is_msensor_active=!1,t.lights_value=0,t.curtains_value=0,t.door_breached_time=0,t.sensor_breached_time=0,t.temp=" ",t.humidity=" ",t.door_breached_time_string="",t.sensor_breached_time_string="";let o=1==t.OccupancyState?t.OccupiedSince:t.UnoccupiedSince;o&&(t.OccupancyDT=p.V0.getElapsedDateTime(new Date(o),this.translate.currentLang,!1));let i=0,r=0,l=!1,c=new Date(1971,1,1).valueOf(),R=!1,A=new Date(1971,1,1).valueOf(),J=this.getRoomAllDevices(t);for(let P=0;P<J.length;P++){let S=J[P];if(S.online&&S.visible&&S.enabled)switch(S.type){case b.Y.DoorSensor:let D=S;t.have_door=!0;let G=S;if(l=l||D.IsOn,l){let a=Date.parse(G.LastBreached.toString());c<a&&(c=a,t.door_breached_time=a)}else{let a=Date.parse(G.LastClosed.toString());c<a&&(c=a,t.door_breached_time=a)}break;case b.Y.MotionSensor:t.have_msensor=!0,R=R||S.IsOn;let u=S;if(R&&u.LastBreached){let a=u.LastBreached.valueOf();A<a&&(t.sensor_breached_time=a,A=a)}else if(u.LastInactive){let a=u.LastInactive.valueOf();A<a&&(t.sensor_breached_time=a,A=a)}break;case b.Y.HumiditySensor:t.have_humidity=!0,t.humidity=S.value+"%";break;case b.Y.TemperatureSensor:if(S.visible&&S.enabled&&S.online){let a=this.convertTempToC(S.properties.Value,S.properties.unit);null!=a&&!Number.isNaN(a)&&0!=a&&(i+=a,r+=1),t.have_temp=!0}break;case b.Y.Thermostat:if(S.visible&&S.enabled&&S.online){let a=this.convertTempToC(S.RoomTemperature,S.room_temperature_unit);null!=a&&0!=a&&(i+=a,r+=1),t.have_temp=!0}}}return t.is_msensor_active=R,t.have_msensor&&(t.sensor_breached_time=A,t.sensor_breached_time_string=p.V0.getElapsedDateTime(new Date(t.sensor_breached_time),this.translate.currentLang,!1)),t.is_door_open=l,t.door_breached_time_string=p.V0.getElapsedDateTime(t.door_breached_time,this.translate.currentLang,!1),t.is_lights_locked=t.is_lights_locked&&t.have_lights,t.is_ac_locked=t.is_ac_locked&&t.have_ac,t.is_curtains_locked=t.is_curtains_locked&&t.have_curtain,r>0&&(t.temp=0!=i&&0!=r?(i/r).toFixed(0)+"\xb0C":"---\xb0C"),t}convertTempToC(t,o="C"){if(o=o.toLowerCase(),t=Number(t),!Number.isNaN(t))return"k"==o?t-273.15:"f"==o?.5555*(t-32):t}findExisitingRoom(t,o){let i=!1;for(let r=0;r<t.length;r++)if(t[r]===o){i=!0;break}return i}toggle(t,o,i,r,l,c,R=!0){var A=this;return(0,w.Z)(function*(){R&&t.children_rooms.length>0?(yield A.alertCtrl.create({header:o,message:i,cssClass:"network-alert",buttons:[{text:A.translate.instant(r),handler:()=>{c(t,l)}},{text:A.translate.instant("cancel"),role:"cancel",handler:()=>{}}]})).present():c(t,l)})()}toggleLights(t,o=!0){let i=this.translate.instant(t.is_lights_on?"turn-off-all-light":"turn-on-all-light"),r=this.translate.instant(t.is_lights_on?"TurnOff":"TurnOn");this.toggle(t,t.name,i,r,!t.is_lights_on,this.toggleLightsForRoom,o),this.refreshAllRooms()}toggleAC(t,o=!0){let i=this.translate.instant(t.is_ac_on?"turn-off-all-acs":"turn-on-all-acs"),r=this.translate.instant(t.is_ac_on?"TurnOff":"TurnOn");this.toggle(t,t.name,i,r,!t.is_ac_on,this.toggleACForRoom,o),this.refreshAllRooms()}toggleCurtains(t,o=!0){let i=this.translate.instant(t.is_curtains_open?"close-all-curtains":"open-all-curtains"),r=this.translate.instant(t.is_curtains_open?"close":"open");this.toggle(t,t.name,i,r,!t.is_curtains_open,this.toggleCurtainsForRoom,o),this.refreshAllRooms()}getRoomAllDevices(t,o=void 0){let i=t.devices.filter(r=>!r.ExcludeFromRoomControl&&(null==o||null!=o&&r.type!=o));for(let r=0;r<t.children_rooms.length;r++)i=i.concat(this.getRoomAllDevices(t.children_rooms[r],b.Y.DoorSensor));return i}refreshAllRooms(){if(this.addedRooms&&this.addedRooms.length)for(let t=0;t<this.addedRooms.length;t++)this.updateRoomInfo(this.addedRooms[t])}openRoom(t){var o=this;return(0,w.Z)(function*(){let i=yield o.loadingCtrl.create({backdropDismiss:!1,spinner:"crescent"});i.present().then(r=>{console.log("Opening Room....",o.filter),""!=o.filter&&null!=o.filter&&null!=o.filter?o.navCtrl.navigateForward(I.Ak,{state:{data:{room:t,filter:o.filter}}}).then(l=>{i.dismiss()}):"device"===o.next_type&&o.navCtrl.navigateForward(I.Ak,{state:{data:{room:t}}}).then(l=>{i.dismiss()})})})()}ionViewDidEnter(){super.ionViewDidEnter(),console.log("ionViewDidEnter RoomsPage"),clearInterval(this._temp_update_timer),this._temp_update_timer=window.setInterval(()=>{this.updateTimer()},1e3),this._delay4sUpdate=()=>{console.log("delay 4s update"),this.delay_update=!1,this.delay_update?(clearTimeout(this.delay_update_timeout),this.delay_update_timeout=window.setTimeout(()=>{this.delay_update=!1,this.refreshAllRooms()},4e3)):this.refreshAllRooms()},this.refreshAllRooms(),p.V0.events.subscribe(M.B.DeviceUpdate.toString(),this._delay4sUpdate)}longPressMouseStart(t,o=1,i=1){let r=c=>{this.touchMoving(c)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",c=>{this.pressEndThing(c),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",r)}),this.longPressStartThing(t,o,i)}longPressStartThing(t,o=1,i=1){t.preventDefault(),this.yScrollDt="mousedown"==t.type?t.pageY:t.changedTouches[0].pageY,this.longPressDetected=!1,this.longPressCounter=window.setTimeout(()=>{this.longPressDetected=!0,this.ChangeVoiceLanguageThing(o,i)},1e3)}touchMoving(t){t.preventDefault(),Math.abs(this.yScrollDt-("mousemove"==t.type?t.pageY:t.changedTouches[0].pageY))>1&&(this.yScrollDt=0,clearTimeout(this.longPressCounter),this.longPressDetected=!1)}pressEndThing(t){t.preventDefault(),clearTimeout(this.longPressCounter),this.longPressDetected=!1}ChangeVoiceLanguageThing(t,o=3){let i=h.a.DefaultController.voiceCommandControl.voice_thing_names.filter(c=>c.thing_id==t&&c.language_id==p.V0.defaultVoiceLanguage.id&&-1!=c.id&&c.thing_type==o),r=[],l=h.a.DefaultController.rooms.find(c=>c.id==t);for(let c=0;c<i.length;c++){if(null==i[c])continue;let R=i[c];R.language_id==p.V0.defaultVoiceLanguage.id&&3==R.thing_type&&r.push({id:R.id,command:""==R.command?null:R.command,lang_id:R.language_id})}console.log(l),this.navCtrl.navigateForward(I.OE,{state:{data:JSON.stringify({commands:r,thing:l.translated_name,direction:p.V0.defaultVoiceLanguage.direction,ui_direction:this.platform.isRTL?"rtl":"ltr",language_symbol:p.V0.defaultVoiceLanguage.displaySymbol,language_id:p.V0.defaultVoiceLanguage.id,thing_id:l.id,thing_type:3})}})}compare(t,o){return(t=0==t?999999:t)==(o=0==o?999999:o)?0:t<o?-1:1}toggle_reorder(){this.addedRooms=this.listOfRooms,this.enable_reorder=!this.enable_reorder,this.reorderSaveState=!!this.enable_reorder}save_reorder(){var t=this;return(0,w.Z)(function*(){if(h.a.DefaultController.user.is_super_user)(yield t.alertCtrl.create({header:t.translate.instant("sort-order"),cssClass:"network-alert",message:t.translate.instant("sort-order-for"),buttons:[{text:t.translate.instant("only-me"),role:"exit",handler:()=>{for(let r=0;r<t.reorderRoomsIds.length;r++){let l=t.reorderRoomsIds[r],c=t.addedRooms[l.from].sort_order;t.addedRooms[l.from].sort_order=t.addedRooms[l.to].sort_order,t.addedRooms[l.to].sort_order=c}t.reorderRoomsIds=[];let i=t.addedRooms.map(r=>r.id);h.a.DefaultController.SetRoomSortOrder(i,!1).then(r=>{t.GetAllRoomsAndResort(),t.reorderSaveState=!1,t.enable_reorder=!t.enable_reorder})}},{text:t.translate.instant("default"),role:"exit",handler:()=>{for(let r=0;r<t.reorderRoomsIds.length;r++){let l=t.reorderRoomsIds[r],c=t.addedRooms[l.from].sort_order;t.addedRooms[l.from].sort_order=t.addedRooms[l.to].sort_order,t.addedRooms[l.to].sort_order=c}t.reorderRoomsIds=[];let i=t.addedRooms.map(r=>r.id);console.log("exiting app"),h.a.DefaultController.SetRoomSortOrder(i,!0).then(r=>{t.GetAllRoomsAndResort(),t.reorderSaveState=!1,t.enable_reorder=!t.enable_reorder})}},{text:t.translate.instant("cancel"),role:"cancel",handler:()=>{}}],backdropDismiss:!0})).present();else{for(let i=0;i<t.reorderRoomsIds.length;i++){let r=t.reorderRoomsIds[i],l=t.addedRooms[r.from].sort_order;t.addedRooms[r.from].sort_order=t.addedRooms[r.to].sort_order,t.addedRooms[r.to].sort_order=l}t.reorderRoomsIds=[];let o=t.addedRooms.map(i=>i.id);h.a.DefaultController.SetRoomSortOrder(o,!1).then(i=>{t.GetAllRoomsAndResort(),t.reorderSaveState=!1,t.enable_reorder=!t.enable_reorder})}})()}reorderArray(t,o){var i=t[o.from];return t.splice(o.from,1),t.splice(o.to,0,i),t}cancel_reorder(){for(let t=0;t<this.reorderRoomsIds.length;t++){let o=this.reorderRoomsIds[t];this.addedRooms=this.reorderArray(this.addedRooms,{from:o.to,to:o.from})}this.reorderRoomsIds=[],this.reorderSaveState=!1,this.enable_reorder=!this.enable_reorder}get_default_order(){var t=this;return(0,w.Z)(function*(){(yield t.alertCtrl.create({header:t.translate.instant("sort-order"),cssClass:"network-alert",message:t.translate.instant("do-you-want-default-sort-order"),buttons:[{text:t.translate.instant("yes"),role:"exit",handler:()=>{console.log("Resorting rooms"),h.a.DefaultController.SetDefaultRoomsSortOrder().then(o=>{console.log("Room Initialied"),t.cancel_reorder(),t.InitializeAllRooms()})}},{text:t.translate.instant("no"),role:"cancel",handler:()=>{t.cancel_reorder()}}]})).present()})()}GetAllRoomsAndResort(){h.a.DefaultController.RefreshRoomsOrder().then(t=>{})}setFavorite(t){console.log("set favorite room",t);for(let o=0;o<this.addedRooms.length;o++)this.addedRooms[o].favorite=!1;t.favorite=!0}reorderItems(t){console.log(t),this.reorderRoomsIds.push({from:t.from,to:t.to}),this.addedRooms=this.reorderArray(this.addedRooms,t)}showOccupancyDialog(t){var o=this;return(0,w.Z)(function*(){const i=yield o.popoverCtrl.create({component:I.Ow,componentProps:{title:o.translate.instant("occupancy"),room:t,occupancy:t.OccupancyState,forcedOccupancy:t.ForceOccupancyState}});i.onDidDismiss().then(function(){var r=(0,w.Z)(function*(l){if(l&&l.data&&void 0!==l.data.occupancy&&void 0!==l.data.forcedOccupancy){const c=yield o.loadingCtrl.create();yield c.present();try{yield t.setOccupancyState(l.data.occupancy,l.data.forcedOccupancy)}catch{}c.dismiss()}});return function(l){return r.apply(this,arguments)}}()),yield i.present()})()}getItems(t){const o=t.target.value;this.addedRooms=o&&o.length>=2?this.listOfRooms.filter(l=>l.translated_name&&l.translated_name.toLowerCase().indexOf(o.toLowerCase())>-1):this.listOfRooms}moveItemUp(t){let o=this.addedRooms.indexOf(t);0!=o&&this.reorderItems({from:o,to:o-1})}moveItemDown(t){let o=this.addedRooms.indexOf(t);o!=this.addedRooms.length-1&&this.reorderItems({from:o,to:o+1})}toggle_hand(){this.disable_hand=!this.disable_hand}reorderItemsEvent(t){t.detail.complete(),this.reorderItems(t.detail)}}return(s=m).\u0275fac=function(t){return new(t||s)(e.Y36(y.SH),e.Y36(p.V0),e.Y36(y.Br),e.Y36(U.sK),e.Y36(y.t4),e.Y36(e.R0b),e.Y36(y.Dh),e.Y36(H.Z),e.Y36(y.yF),e.Y36(y.HT),e.Y36(y.X1),e.Y36(E.F0),e.Y36(e.sBO))},s.\u0275cmp=e.Xpm({type:s,selectors:[["rooms"]],features:[e.qOj],decls:33,vars:15,consts:[["hideBackButton","true",2,"text-align","center","direction","ltr",3,"ngStyle"],[2,"padding","5px"],[2,"text-align","end","float","right","min-width","10px"],["showWhen","android,ios",1,"top-mic-button",2,"vertical-align","bottom",3,"touchstart","touchend"],["name","mic",1,"voice-mic-button"],[1,"top-badge"],["style","background: transparent;","ion-button","","clear","","class","top-mic-button",3,"click",4,"ngIf"],[2,"width","40px","float","left","display","block"],["tappable","","component-click","","tabindex","0",1,"top-mic-button",2,"font-size","30px","text-align","center","vertical-align","middle",3,"click"],["name","chevron-back",2,"font-size","1.2em"],[1,"filter-header"],["size","12"],["animated","true","debounce","500",2,"width","100%","padding","0px",3,"placeholder","ionInput"],[3,"disabled","ionItemReorder"],["ion-item","",3,"key",4,"ngFor","ngForOf"],["ion-button","","clear","",1,"top-mic-button",2,"background","transparent",3,"click"],["name","code",1,"rotate-90",2,"font-size","x-large"],[2,"font-size","x-large",3,"name"],["name","code-working",1,"rotate-90",2,"font-size","x-large"],["name","checkmark",2,"font-size","x-large"],["name","close",2,"font-size","x-large"],["ion-item","",3,"key"],[1,"ion-justify-content-end"],["size","auto","tappable","",1,"button"],["item-start",""],["ion-button","",1,"room-item-image",3,"click"],[3,"src"],["align-self-top",""],[2,"text-align","center"],[1,"room-title",3,"touchstart","mousedown","touchmove","touchend"],[1,"break-line-grad"],[4,"ngIf"],[1,"room-detail-grid"],["size","3",2,"pointer-events","all",3,"click"],[1,"room-device-icon",2,"background-size","cover",3,"src"],["size","3"],[1,"room-device-icon",3,"src"],["size","3",3,"class"],[1,"room-detail-text"],["size","3",2,"direction","ltr"],["class","reorder-overlay-clear no-pointer",4,"ngIf"],[2,"--ion-grid-column-padding-xs","0px","--ion-grid-column-padding-xs","0px"],["size","4"],["ion-button","",3,"click"],["class","overlay-clear",4,"ngIf"],[1,"overlay-clear"],[1,"lock-device",2,"width","16px","vertical-align","middle","top","5px","position","absolute","left","5px",3,"src"],[1,"reorder-overlay-clear","no-pointer"],["ion-button","","clear","",1,"pointer",2,"position","absolute","top","5px","right","20px","width","10px",3,"click"],["name","chevron-up",2,"color","white","border-top","3px solid"],["ion-button","","clear","",1,"pointer",2,"position","absolute","bottom","5px","right","20px","width","10px",3,"click"],["name","chevron-down",2,"color","white","border-bottom","3px solid"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"div")(3,"div",1)(4,"div",2),e._UZ(5,"connection-warning"),e.TgZ(6,"a",3),e.NdJ("touchstart",function(r){return o.longPressStart(r)})("touchend",function(){return o.PressEnd()}),e._UZ(7,"ion-icon",4),e.TgZ(8,"ion-badge",5),e._uU(9),e.qZA()()(),e.TgZ(10,"div",2),e.YNc(11,Q,2,0,"button",6),e.YNc(12,B,2,1,"button",6),e.YNc(13,q,2,0,"button",6),e.YNc(14,V,2,0,"button",6),e.YNc(15,z,2,0,"button",6),e.qZA(),e.TgZ(16,"div",7)(17,"a",8),e.NdJ("click",function(){return o.goBack()}),e._UZ(18,"ion-icon",9),e.qZA()()(),e.TgZ(19,"div")(20,"ion-title"),e._uU(21),e.ALo(22,"translate"),e.qZA()()()(),e.TgZ(23,"ion-toolbar")(24,"ion-grid",10)(25,"ion-row")(26,"ion-col",11)(27,"ion-searchbar",12),e.NdJ("ionInput",function(r){return o.getItems(r)}),e.ALo(28,"translate"),e.qZA()()()()()(),e.TgZ(29,"ion-content")(30,"ion-list")(31,"ion-reorder-group",13),e.NdJ("ionItemReorder",function(r){return o.reorderItemsEvent(r)}),e.YNc(32,ie,47,33,"ion-reorder",14),e.qZA()()()),2&t&&(e.xp6(1),e.Q6J("ngStyle",o.theAppState.iontoolbarStyle),e.xp6(8),e.Oqu(o.speech_language_symbol),e.xp6(2),e.Q6J("ngIf",!o.reorderSaveState),e.xp6(1),e.Q6J("ngIf",o.reorderSaveState),e.xp6(1),e.Q6J("ngIf",o.reorderSaveState),e.xp6(1),e.Q6J("ngIf",o.reorderSaveState),e.xp6(1),e.Q6J("ngIf",o.reorderSaveState),e.xp6(6),e.Oqu(e.lcZ(22,11,"rooms")),e.xp6(6),e.s9C("placeholder",e.lcZ(28,13,"search")),e.xp6(4),e.Q6J("disabled",o.disable_hand),e.xp6(1),e.Q6J("ngForOf",o.addedRooms))},dependencies:[k.sg,k.O5,k.PC,f.yp,f.PM,f.wI,f.W2,f.jY,f.Gu,f.gu,f.q_,f.Nh,f.oz,f.Nd,f.VI,f.wd,f.sr,f.j9,Y.T,F.t,U.X$],styles:["[_ngcontent-%COMP%]:root   .fav-button[_ngcontent-%COMP%]{text-align:center;position:absolute;width:25%;background:gray;color:#fff}[_ngcontent-%COMP%]:root   .fav-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{line-height:3.5;pointer-events:none}[_ngcontent-%COMP%]:root   .card-md[_ngcontent-%COMP%]{border-radius:10px!important;box-shadow:#000000ba 1px 1px 5px}[_ngcontent-%COMP%]:root   .fav-button.active[_ngcontent-%COMP%]{color:#fff;background:gold}a[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{display:inline-block}"]}),m})()}];let se=(()=>{var s;class m{}return(s=m).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[E.Bz.forChild(re),E.Bz]}),m})();var ae=d(23934);let le=(()=>{var s;class m{}return(s=m).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[k.ez,C.u5,f.Pc,se,ae.o,U.aw]}),m})()},59764:(N,O,d)=>{d.d(O,{T:()=>w});var k=d(15861),C=d(65879),f=d(56223),E=d(28662);let w=(()=>{var p;class I{mouseDownEventHandler(g){g.stopImmediatePropagation(),g.preventDefault()}keyEventHandler(g){var x=this;return(0,k.Z)(function*(){if(g.stopImmediatePropagation(),g.preventDefault(),"Enter"==g.key||" "==g.key){var Z;let h=null===(Z=document.activeElement)||void 0===Z?void 0:Z.className.toLowerCase();if(h&&(h.indexOf("range-knob-handle")>-1||h.indexOf("range-md")>-1)&&h.indexOf("range-knob-handle")>-1&&(console.log("range-knob-handle"),document.activeElement&&document.activeElement.getAttribute("aria-valuenow"))){let e=document.activeElement.getAttribute("aria-valuenow");if(e){let y=Number.parseFloat(e);if(y||0===y)return console.log("range-knob-handle value change to "+y),void x.model.update.emit(y)}}let M=x.el.nativeElement.nodeName.toLowerCase();const L=yield E.A.getInfo();["button","ion-checkbox","a"].indexOf(M)>-1?"android"!==L.operatingSystem.toLowerCase()&&x.el.nativeElement.click():"!android"!==L.operatingSystem.toLowerCase()&&x.clickOnElement(x.el)}})()}clickOnElement(g){if(document.createEvent){let x=document.createEvent("MouseEvents");x.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),g.nativeElement.dispatchEvent(x)}}mouseDownOnElement(g){let x=new MouseEvent("mousedown",{bubbles:!0,cancelable:!1});g.nativeElement.dispatchEvent(x)}constructor(g,x,Z){this.el=g,this.renderer=x,this.model=Z,this.eventEmitter=new C.vpe}ngOnInit(){}}return(p=I).\u0275fac=function(g){return new(g||p)(C.Y36(C.SBq),C.Y36(C.Qsj),C.Y36(f.On))},p.\u0275dir=C.lG2({type:p,selectors:[["","component-click",""]],hostBindings:function(g,x){1&g&&C.NdJ("mousedown",function(h){return x.mouseDownEventHandler(h)})("keypress",function(h){return x.keyEventHandler(h)})},outputs:{eventEmitter:"eventEmitter"},features:[C._Bn([f.On])]}),I})()}}]);